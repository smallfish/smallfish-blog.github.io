
<!DOCTYPE html>
<html lang="zh-CN">

    <head>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <meta property="og:title" content=" Nginx 第三方模块试用记 &middot;  smallfish&#39;s blog" />
        <meta property="og:site_name" content="smallfish&#39;s blog" />
        <meta property="og:url" content="http://chenxiaoyu.org/2011/10/30/nginx-modules/" />

    
        <meta property="og:type" content="article" />
        <meta property="og:article:published_time" content="2011-10-30T00:00:00Z" />
        

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@" />
        <meta name="twitter:creator" content="@" />
        <meta name="twitter:title" content="Nginx 第三方模块试用记" />
        <meta name="twitter:description" content="" />
        <meta name="twitter:url" content="http://chenxiaoyu.org/2011/10/30/nginx-modules/" />
    

        <title> Nginx 第三方模块试用记 &middot;  smallfish&#39;s blog</title>

    
        <meta name="description" content="" />
    
        
        <meta name="p:domain_verify" content="fc173d84e3a4de948ed4bda2908afd3e"/>
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        
          

    
        <link href="http://chenxiaoyu.org/index.xml" rel="alternate" type="application/rss+xml" title="smallfish&#39;s blog" />
    

    
        <link rel="canonical" href="http://chenxiaoyu.org/2011/10/30/nginx-modules/" />

    
    <script type="application/ld+json">
    { 
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "Nginx 第三方模块试用记",
        "author": {
            "@type": "Person",
            "name": "http://profiles.google.com/?rel=author"
        },
        "datePublished": "2011-10-30",
        "description": "",
        "wordCount": 217
    }
    </script>
    
    
    <style>
*{padding:0;margin:0}body,html{font-size:1em;line-height:1.65em;font-family:"Open Sans",sans-serif;font-weight:300;color:#444}html{height:100%}body{padding:2em 2.5em 1em 20em}header{border-right:1px #eee solid;padding:2em;position:fixed;top:0;left:0;height:100%;width:13.5em}#content{display:block;width:100%}footer{padding:1em 0 2.5em;font-size:.8em;line-height:1.5em;color:#888}article{border-bottom:.1em #eee solid;padding-bottom:1.7em;max-width:56em}h4,h5,h6,hr,p{margin-top:.9em;margin-bottom:.9em}h1,h2,h3,h4,h5,h6{font-family:"Bree Serif",serif;font-weight:400!important}h1{font-size:2.5em;line-height:1.1em;margin-top:.6em;margin-bottom:.6em}h2{font-size:1.9em;line-height:1.2em;margin-top:.7em;margin-bottom:.7em}h3{font-size:1.4em;line-height:1.3em;margin-top:.8em;margin-bottom:.8em}h4{font-size:1.3em}h5{font-size:1.2em}h6{font-size:1.1em}iframe,img{max-width:100%}a{font-weight:700;text-decoration:none;color:#5cc265}a:hover{text-decoration:underline}h1 a,h2 a,h3 a,h4 a,h5 a,h6 a{font-weight:400!important}strong{font-weight:700}blockquote{border-left:.4em solid #eee;padding-left:1.2em;font-size:1.3em}hr{border:0;height:1px;background:#eee}ol,ul{margin-left:3em}code{font-size:1.4em;background:#eee}pre{font-size:.8em;line-height:2em;background:#eee;padding:1em;word-break:break-all;word-wrap:break-word;white-space:pre;white-space:-moz-pre-wrap;white-space:pre-wrap}input{font-size:1em;padding:.3em}header h1{font-size:1.9em;margin-top:.8em;margin-bottom:.6em}header h1 a{color:#444}header h1 a:hover{text-decoration:none}header #logo img{width:9em;height:9em;border-radius:4.5em;-moz-border-radius:4.5em;-webkit-border-radius:4.5em;border:none}#follow-icons{font-size:.7em;margin-top:-.7em;margin-bottom:1.5em}#follow-icons a{color:#ccc}#follow-icons span{vertical-align:top;margin-left:-.15em;margin-right:-.15em}#follow-icons span .fa-stack-1x{font-size:1.05em;line-height:1.9em}header h6{margin-top:.5em}article span.post-stamp{color:#888}h1.post-title{margin-top:.35em;margin-bottom:.6em}h3.post-title{margin-top:.4em;padding-bottom:.9em;border-bottom:1px solid #eee;font-size:1.2em;color:#444}.post-title .feature-star{font-size:.9em}.feature-star,.separator,.taglist{color:#ccc}.taglist a{background-color:#ccc;color:#fff;display:inline-block;line-height:1.5em;padding:.3em .6em;vertical-align:20%;font-size:.5em;font-family:"Open Sans",sans-serif;font-weight:700!important;text-transform:uppercase;letter-spacing:.05em;border-radius:.25em;-moz-border-radius:.25em;-webkit-border-radius:.25em}#social-bar{margin-top:1.5em;background-color:#eee;padding:.5em}#comments{margin-top:.15em;padding-bottom:.2em;border-bottom:1px solid #eee}.pagination{margin-bottom:1em}footer a{font-weight:300;color:#888;text-decoration:underline}footer a:hover{color:#444;text-decoration:none}@media only screen and (min-width:1281px){body,html{font-size:1.1em}}@media only screen and (max-width:800px){body{padding:0}header{border-right:none;border-bottom:1px #eee solid;position:relative;height:auto;width:auto;text-align:center;padding-bottom:1em}#content{margin-left:0;padding:2em 2em 1em;width:auto}footer{padding:0 2.5em 2em}}@media only screen and (max-width:320px){#content,header{padding:1.2em 1.2em .6em}footer{padding:0 1.5em 1.2em}ol,ul{margin-left:2em}}
</style>
    </head>
    <body>
        <header id="header">
            <a id="logo" href="http://chenxiaoyu.org/"><img src="https://avatars1.githubusercontent.com/u/105860?v=3&s=460" alt="smallfish&#39;s blog" /></a>
            <h1><a href="http://chenxiaoyu.org/">smallfish&#39;s blog</a></h1>
            <p></p>

            <div id="follow-icons">
	<a href="http://github.com/smallfish" rel="me"><i class="fa fa-github-square fa-2x"></i></a>
	<a href="http://twitter.com/smallfishxy" rel="me"><i class="fa fa-twitter-square fa-2x"></i></a>
	<a href="http://chenxiaoyu.org/index.xml" rel="me"><i class="fa fa-rss-square fa-2x"></i></a> 
</div>  

            Engineer@Alibaba, Alipay

        </header>

<main id="content">

<article id="" class="2011">
    <div class="post-stamp">
        <time datetime="2011-10-30T00:00:00Z">
            30 Oct 2011
        </time>
        <span class="taglist">
        
        </span>
    </div>
    <h1 class="post-title">Nginx 第三方模块试用记</h1>
    <p>最近试用了几个<a href="http://weibo.com/agentzh">@agentzh</a>写的第三方<a href="http://nginx.net">Nginx</a>模块，甚为愉悦，没想到在Nginx可以玩很多技巧和扩展，分享一下。</p>

<p>本文尝试的几个模块大概分为：</p>

<ul>
<li>echo</li>
<li>memcached</li>
<li>nginx</li>
<li>lua</li>
</ul>

<p>详细模块地址分别为：</p>

<ul>
<li>ngx_devel_kit <a href="https://github.com/simpl/ngx_devel_kit">https://github.com/simpl/ngx_devel_kit</a></li>
<li>set-misc-nginx-module <a href="https://github.com/agentzh/set-misc-nginx-module">https://github.com/agentzh/set-misc-nginx-module</a></li>
<li>memc-nginx-module <a href="https://github.com/agentzh/memc-nginx-module">https://github.com/agentzh/memc-nginx-module</a></li>
<li>echo-nginx-module <a href="https://github.com/agentzh/echo-nginx-module">https://github.com/agentzh/echo-nginx-module</a></li>
<li>lua-nginx-module <a href="https://github.com/chaoslawful/lua-nginx-module">https://github.com/chaoslawful/lua-nginx-module</a></li>
<li>srcache-nginx-module <a href="https://github.com/agentzh/srcache-nginx-module">https://github.com/agentzh/srcache-nginx-module</a></li>
<li>drizzle-nginx-module <a href="https://github.com/chaoslawful/drizzle-nginx-module">https://github.com/chaoslawful/drizzle-nginx-module</a></li>
<li>rds-json-nginx-module <a href="https://github.com/agentzh/rds-json-nginx-module">https://github.com/agentzh/rds-json-nginx-module</a></li>
</ul>

<p>为了省事这里一股脑把上面的module全部下载好，一起编译。PS：如果更懒惰的可以尝试下<a href="http://openresty.org">openresty</a>项目，它帮你打包好Nginx和一堆扩展模块，得感谢@agentzh。</p>

<p>这里编译和drizzle和lua模块，在编译Nginx之前需要设置一下这两个库的LIB和INCLUDE文件地址：</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>-- lua --
<span class="nb">export</span> <span class="nv">LUA_LIB</span><span class="o">=</span>/path/to/lua/lib
<span class="nb">export</span> <span class="nv">LUA_INC</span><span class="o">=</span>/path/to/lua/include

-- drizzle --
<span class="nb">export</span> <span class="nv">LIBDRIZZLE_INC</span><span class="o">=</span>/opt/drizzle/include/libdrizzle-1.0
<span class="nb">export</span> <span class="nv">LIBDRIZZLE_LIB</span><span class="o">=</span>/opt/drizzle/lib
</code></pre></div>


<p>Nginx编译选项如下，请注意先后顺序：</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>./configure --prefix<span class="o">=</span>/opt/nginx <span class="se">\</span>
    --with-pcre<span class="o">=</span>../pcre <span class="se">\</span>
    --add-module<span class="o">=</span>../ngx_devel_kit <span class="se">\</span>
    --add-module<span class="o">=</span>../set-misc-nginx-module <span class="se">\</span>
    --add-module<span class="o">=</span>../memc-nginx-module <span class="se">\</span>
    --add-module<span class="o">=</span>../echo-nginx-module <span class="se">\</span>
    --add-module<span class="o">=</span>../lua-nginx-module <span class="se">\</span>
    --add-module<span class="o">=</span>../srcache-nginx-module <span class="se">\</span>
    --add-module<span class="o">=</span>../drizzle-nginx-module <span class="se">\</span>
    --add-module<span class="o">=</span>../rds-json-nginx-module
</code></pre></div>


<p>重新编译Nginx二进制，Nginx需要quit再启动。而普通配置更新则reload即可：</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="m">1</span>. <span class="nb">kill</span> -HUP <span class="sb">`</span>cat /path/nginx/logs/nginx.pid<span class="sb">`</span>
<span class="m">2</span>. /path/nginx/sbin/nginx -s reload
</code></pre></div>


<p>PS：详细的模块编译可以参考各自模块的文档说明。</p>

<p>好吧，假设到这里已经安装和编译好Nginx以及一堆第三方扩展。下面开始尝试上面那些有趣的模块~</p>

<p><strong>场景1：Helloworld</strong></p>

<p>程序里helloworld很简单，nginx的hello如何实现呢？</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="m">1</span>. 最简单的helloworld
location /hello1 <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">&quot;hello 1111!&quot;</span><span class="p">;</span>
<span class="o">}</span>

<span class="m">2</span>. 异步请求其他echo请求
location /hello2 <span class="o">{</span>
    <span class="nb">echo</span> <span class="s2">&quot;hello 2222!&quot;</span><span class="p">;</span>
    echo_location_async /hello1<span class="p">;</span>
<span class="o">}</span>

<span class="m">3</span>. 输出GET请求参数，假设参数名是name，这里并对name参数进行解码
location /hello3 <span class="o">{</span>
    set_unescape_uri <span class="nv">$name</span> <span class="nv">$arg_name</span><span class="p">;</span>
    set_if_empty <span class="nv">$name</span> <span class="s2">&quot;None&quot;</span><span class="p">;</span>
    <span class="nb">echo</span> <span class="s2">&quot;hello, </span><span class="nv">$name</span><span class="s2">!&quot;</span><span class="p">;</span>
<span class="o">}</span>

是不是很帅气有趣。例2中的subrequest是完全non-blocking的。
echo模块还有timer扩展，页面输出加载时间也是小case了。
</code></pre></div>


<p><strong>场景2：Memcached HTTP 接口</strong></p>

<p>想当年哥为了兼容不同语言的api，自己封装了memcached操作，真是挺苦逼的，当时还非常羡慕tokyotyrant的http接口来着，现在用memc模块效果一样，还有upstream和keepalive功能哦~</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>location /memcached <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">$memc_cmd</span> <span class="nv">$arg_cmd</span><span class="p">;</span>
    <span class="nb">set</span> <span class="nv">$memc_key</span> <span class="nv">$arg_key</span><span class="p">;</span>
    <span class="nb">set</span> <span class="nv">$memc_value</span> <span class="nv">$arg_val</span><span class="p">;</span>
    <span class="nb">set</span> <span class="nv">$memc_exptime</span> <span class="nv">$arg_exptime</span><span class="p">;</span>
    memc_pass <span class="m">127</span>.0.0.1:11211<span class="p">;</span>
<span class="o">}</span>

URL访问类似 http://host:port/memcached?cmd<span class="o">=</span>aaa<span class="p">&amp;</span><span class="nv">key</span><span class="o">=</span>bbb<span class="p">&amp;</span><span class="nv">val</span><span class="o">=</span>ccc

还需要自己封装么？完全的基于url编程了，不再考虑各自语言的memcached api，cluster也简化了。
</code></pre></div>


<p><strong>场景3：数据库查询</strong></p>

<p>这里用了libdrizzle模块，兼容MySQL、Drizzle、SQLite数据库。有时候为了一些查询或者接口，还需要用语言来封装一些数据库查询操作，现在直接通过drizzle模块可以很轻松的做到~~</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span><span class="c1"># 添加MySQL配置</span>
upstream mysql <span class="o">{</span>
    drizzle_server <span class="m">127</span>.0.0.1:3306 <span class="nv">dbname</span><span class="o">=</span><span class="nb">test</span> <span class="nv">user</span><span class="o">=</span>smallfish <span class="nv">password</span><span class="o">=</span><span class="m">123</span> <span class="nv">protocol</span><span class="o">=</span>mysql<span class="p">;</span>
<span class="o">}</span>

<span class="c1"># 通过url匹配出name，并编码防止注入，最后以json格式输出结果。</span>
location ~ <span class="s1">&#39;^/mysql/(.*)&#39;</span> <span class="o">{</span>
    <span class="nb">set</span> <span class="nv">$name</span> <span class="nv">$1</span><span class="p">;</span>
    set_quote_sql_str <span class="nv">$quote_name</span> <span class="nv">$name</span><span class="p">;</span>
    <span class="nb">set</span> <span class="nv">$sql</span> <span class="s2">&quot;SELECT * FROM users WHERE name=</span><span class="nv">$quote_name</span><span class="s2">&quot;</span><span class="p">;</span>
    drizzle_query <span class="nv">$sql</span><span class="p">;</span>
    drizzle_pass mysql<span class="p">;</span>
    rds_json on<span class="p">;</span>
<span class="o">}</span>

<span class="c1"># 查看MySQL服务状态，这个很实用哦。</span>
location /mysql-status <span class="o">{</span>
    drizzle_status<span class="p">;</span>
<span class="o">}</span>
</code></pre></div>


<p><strong>场景4：lua扩展</strong></p>

<p>内嵌lua语言，超级牛力哦~~~想干啥都可以了，而且还可以充分发挥lua coroutine的风骚，淘宝量子统计完全是lua扩展。</p>

<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span></span>location /lua1 <span class="o">{</span>
    default_type <span class="s1">&#39;text/plain&#39;</span><span class="p">;</span>
    content_by_lua <span class="s1">&#39;ngx.say(&quot;hello, lua&quot;)&#39;</span><span class="p">;</span>
<span class="o">}</span>

<span class="c1"># 请求另外的url</span>
location /lua2 <span class="o">{</span>
    content_by_lua <span class="s1">&#39;</span>
<span class="s1">        local res = ngx.location.capture(&quot;/hello1&quot;)</span>
<span class="s1">        ngx.say(&quot;data: &quot; .. res.body)</span>
<span class="s1">     &#39;</span><span class="p">;</span>
<span class="o">}</span>

Lua支持的选项很多，具体可参考官网WIKI文档。
</code></pre></div>


<p>嗯，这里尝试玩了几个模块，详细的例子可以参考各自的模块文档，里面都有详细的说明和选项配置。</p>

<p>可以看出和传统编程有些微不同之处，完全是基于URL的HTTP接口，比传统的方式更为简单，更为清晰。还有non-blocking的实现，更见轻便。</p>

    <div id="social-bar">
	<ul class="rrssb-buttons clearfix">
      <li class="email">
          <a href="mailto:?subject=Nginx%20%e7%ac%ac%e4%b8%89%e6%96%b9%e6%a8%a1%e5%9d%97%e8%af%95%e7%94%a8%e8%ae%b0&amp;body=http://chenxiaoyu.org/2011/10/30/nginx-modules/">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path transform="scale(0.014,-0.014) translate(0,-1670)" d="M1792 826v-794q0 -66 -47 -113t-113 -47h-1472q-66 0 -113 47t-47 113v794q44 -49 101 -87q362 -246 497 -345q57 -42 92.5 -65.5t94.5 -48t110 -24.5h1h1q51 0 110 24.5t94.5 48t92.5 65.5q170 123 498 345q57 39 100 87zM1792 1120q0 -79 -49 -151t-122 -123 q-376 -261 -468 -325q-10 -7 -42.5 -30.5t-54 -38t-52 -32.5t-57.5 -27t-50 -9h-1h-1q-23 0 -50 9t-57.5 27t-52 32.5t-54 38t-42.5 30.5q-91 64 -262 182.5t-205 142.5q-62 42 -117 115.5t-55 136.5q0 78 41.5 130t118.5 52h1472q65 0 112.5 -47t47.5 -113z"/>
                  </svg>
              </span>
              <span class="text">Email</span>
          </a>
      </li>
      <li class="facebook">
          <a href="https://www.facebook.com/sharer/sharer.php?u=http://chenxiaoyu.org/2011/10/30/nginx-modules/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434 c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726 c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"/>
                  </svg>
              </span>
              <span class="text">Facebook</span>
          </a>
      </li>
			<li class="twitter">
          <a href="http://twitter.com/home?status=Nginx%20%e7%ac%ac%e4%b8%89%e6%96%b9%e6%a8%a1%e5%9d%97%e8%af%95%e7%94%a8%e8%ae%b0%20http://chenxiaoyu.org/2011/10/30/nginx-modules/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
		                  <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32 c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155 C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965 C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683 c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851 C26.275,7.229,25.39,8.196,24.253,8.756z"/>
                  </svg>
              </span>
              <span class="text">Twitter</span>
          </a>
      </li>
			<li class="linkedin">
          <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://chenxiaoyu.org/2011/10/30/nginx-modules/&amp;title=Nginx%20%e7%ac%ac%e4%b8%89%e6%96%b9%e6%a8%a1%e5%9d%97%e8%af%95%e7%94%a8%e8%ae%b0&amp;summary=%e6%9c%80%e8%bf%91%e8%af%95%e7%94%a8%e4%ba%86%e5%87%a0%e4%b8%aa%40agentzh%e5%86%99%e7%9a%84%e7%ac%ac%e4%b8%89%e6%96%b9Nginx%e6%a8%a1%e5%9d%97%ef%bc%8c%e7%94%9a%e4%b8%ba%e6%84%89%e6%82%a6%ef%bc%8c%e6%b2%a1%e6%83%b3%e5%88%b0%e5%9c%a8Nginx%e5%8f%af%e4%bb%a5%e7%8e%a9%e5%be%88%e5%a4%9a%e6%8a%80%e5%b7%a7%e5%92%8c%e6%89%a9%e5%b1%95%ef%bc%8c%e5%88%86%e4%ba%ab%e4%b8%80%e4%b8%8b%e3%80%82%0a%e6%9c%ac%e6%96%87%e5%b0%9d%e8%af%95%e7%9a%84%e5%87%a0%e4%b8%aa%e6%a8%a1%e5%9d%97%e5%a4%a7%e6%a6%82%e5%88%86%e4%b8%ba%ef%bc%9a%0a%20echo%20memcached%20nginx%20lua%20%20%e8%af%a6%e7%bb%86%e6%a8%a1%e5%9d%97%e5%9c%b0%e5%9d%80%e5%88%86%e5%88%ab%e4%b8%ba%ef%bc%9a%0a%20ngx_devel_kit%20https%3a%2f%2fgithub.com%2fsimpl%2fngx_devel_kit%20set-misc-nginx-module%20https%3a%2f%2fgithub.com%2fagentzh%2fset-misc-nginx-module%20memc-nginx-module%20https%3a%2f%2fgithub.com%2fagentzh%2fmemc-nginx-module%20echo-nginx-module%20https%3a%2f%2fgithub.com%2fagentzh%2fecho-nginx-module%20lua-nginx-module%20https%3a%2f%2fgithub.com%2fchaoslawful%2flua-nginx-module%20srcache-nginx-module%20https%3a%2f%2fgithub.com%2fagentzh%2fsrcache-nginx-module%20drizzle-nginx-module%20https%3a%2f%2fgithub.com%2fchaoslawful%2fdrizzle-nginx-module%20rds-json-nginx-module%20https%3a%2f%2fgithub.com%2fagentzh%2frds-json-nginx-module%20%20%e4%b8%ba%e4%ba%86%e7%9c%81%e4%ba%8b%e8%bf%99%e9%87%8c%e4%b8%80%e8%82%a1%e8%84%91%e6%8a%8a%e4%b8%8a%e9%9d%a2%e7%9a%84module%e5%85%a8%e9%83%a8%e4%b8%8b%e8%bd%bd%e5%a5%bd%ef%bc%8c%e4%b8%80%e8%b5%b7%e7%bc%96%e8%af%91%e3%80%82PS%ef%bc%9a%e5%a6%82%e6%9e%9c%e6%9b%b4%e6%87%92%e6%83%b0%e7%9a%84%e5%8f%af%e4%bb%a5%e5%b0%9d%e8%af%95%e4%b8%8bopenresty%e9%a1%b9%e7%9b%ae%ef%bc%8c%e5%ae%83%e5%b8%ae%e4%bd%a0%e6%89%93%e5%8c%85%e5%a5%bdNginx%e5%92%8c%e4%b8%80%e5%a0%86%e6%89%a9%e5%b1%95%e6%a8%a1%e5%9d%97%ef%bc%8c%e5%be%97%e6%84%9f%e8%b0%a2%40agentzh%e3%80%82%0a%e8%bf%99%e9%87%8c%e7%bc%96%e8%af%91%e5%92%8cdrizzle%e5%92%8clua%e6%a8%a1%e5%9d%97%ef%bc%8c%e5%9c%a8%e7%bc%96%e8%af%91Nginx%e4%b9%8b%e5%89%8d%e9%9c%80%e8%a6%81%e8%ae%be%e7%bd%ae%e4%b8%80%e4%b8%8b%e8%bf%99%e4%b8%a4%e4%b8%aa%e5%ba%93%e7%9a%84LIB%e5%92%8cINCLUDE%e6%96%87%e4%bb%b6%e5%9c%b0%e5%9d%80%ef%bc%9a%0a--%20lua%20--%20export%20LUA_LIB%3d%2fpath%2fto%2flua%2flib%20export%20LUA_INC%3d%2fpath%2fto%2flua%2finclude%20--%20drizzle%20--%20export%20LIBDRIZZLE_INC%3d%2fopt%2fdrizzle%2finclude%2flibdrizzle-1.0%20export%20LIBDRIZZLE_LIB%3d%2fopt%2fdrizzle%2flib%20%20Nginx%e7%bc%96%e8%af%91%e9%80%89%e9%a1%b9%e5%a6%82%e4%b8%8b%ef%bc%8c%e8%af%b7%e6%b3%a8%e6%84%8f%e5%85%88%e5%90%8e%e9%a1%ba%e5%ba%8f%ef%bc%9a%0a.%2fconfigure%20--prefix%3d%2fopt%2fnginx%20%5c%20--with-pcre%3d..%2fpcre%20%5c%20--add-module%3d..%2fngx_devel_kit%20%5c%20--add-module%3d..%2fset-misc-nginx-module%20%5c%20--add-module%3d..%2fmemc-nginx-module%20%5c%20--add-module%3d..%2fecho-nginx-module%20%5c%20--add-module%3d..%2flua-nginx-module%20%5c%20--add-module%3d..%2fsrcache-nginx-module%20%5c%20--add-module%3d..%2fdrizzle-nginx-module%20%5c%20--add-module%3d..%2frds-json-nginx-module%20%20%e9%87%8d%e6%96%b0%e7%bc%96%e8%af%91Nginx%e4%ba%8c%e8%bf%9b%e5%88%b6%ef%bc%8cNginx%e9%9c%80%e8%a6%81quit%e5%86%8d%e5%90%af%e5%8a%a8%e3%80%82%e8%80%8c%e6%99%ae%e9%80%9a%e9%85%8d%e7%bd%ae%e6%9b%b4%e6%96%b0%e5%88%99reload%e5%8d%b3%e5%8f%af%ef%bc%9a%0a1.%20kill%20-HUP%20%60cat%20%2fpath%2fnginx%2flogs%2fnginx...." class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path d="M25.424,15.887v8.447h-4.896v-7.882c0-1.979-0.709-3.331-2.48-3.331c-1.354,0-2.158,0.911-2.514,1.803 c-0.129,0.315-0.162,0.753-0.162,1.194v8.216h-4.899c0,0,0.066-13.349,0-14.731h4.899v2.088c-0.01,0.016-0.023,0.032-0.033,0.048 h0.033V11.69c0.65-1.002,1.812-2.435,4.414-2.435C23.008,9.254,25.424,11.361,25.424,15.887z M5.348,2.501 c-1.676,0-2.772,1.092-2.772,2.539c0,1.421,1.066,2.538,2.717,2.546h0.032c1.709,0,2.771-1.132,2.771-2.546 C8.054,3.593,7.019,2.501,5.343,2.501H5.348z M2.867,24.334h4.897V9.603H2.867V24.334z"/>
                  </svg>
              </span>
              <span class="text">LinkedIn</span>
          </a>
      </li>
      <li class="tumblr">
					<script>
						document.write('<a href="http://www.tumblr.com/share?v=3&amp;u=' + encodeURIComponent('http:\/\/chenxiaoyu.org\/2011\/10\/30\/nginx-modules\/') + '&amp;t=Nginx 第三方模块试用记" class="popup">');
					</script>
              <span class="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
											<path d="M18.02 21.842c-2.029 0.052-2.422-1.396-2.439-2.446v-7.294h4.729V7.874h-4.71V1.592c0 0-3.653 0-3.714 0 s-0.167 0.053-0.182 0.186c-0.218 1.935-1.144 5.33-4.988 6.688v3.637h2.927v7.677c0 2.8 1.7 6.7 7.3 6.6 c1.863-0.03 3.934-0.795 4.392-1.453l-1.22-3.539C19.595 21.6 18.7 21.8 18 21.842z"/>
									</svg>
              </span>
              <span class="text">Tumblr</span>
          <script>document.write('</a>');</script>
      </li>
      <li class="reddit">
          <a href="http://www.reddit.com/submit?url=http://chenxiaoyu.org/2011/10/30/nginx-modules/">
              <span class="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
											<g>
													<path d="M11.794 15.316c0-1.029-0.835-1.895-1.866-1.895c-1.03 0-1.893 0.865-1.893 1.895s0.863 1.9 1.9 1.9 C10.958 17.2 11.8 16.3 11.8 15.316z"/>
													<path d="M18.1 13.422c-1.029 0-1.895 0.864-1.895 1.895c0 1 0.9 1.9 1.9 1.865c1.031 0 1.869-0.836 1.869-1.865 C19.969 14.3 19.1 13.4 18.1 13.422z"/>
													<path d="M17.527 19.791c-0.678 0.678-1.826 1.006-3.514 1.006c-0.004 0-0.009 0-0.014 0c-0.004 0-0.01 0-0.015 0 c-1.686 0-2.834-0.328-3.51-1.005c-0.264-0.265-0.693-0.265-0.958 0c-0.264 0.265-0.264 0.7 0 1 c0.943 0.9 2.4 1.4 4.5 1.402c0.005 0 0 0 0 0c0.005 0 0 0 0 0c2.066 0 3.527-0.459 4.47-1.402 c0.265-0.264 0.265-0.693 0.002-0.958C18.221 19.5 17.8 19.5 17.5 19.791z"/>
													<path d="M27.707 13.267c0-1.785-1.453-3.237-3.236-3.237c-0.793 0-1.518 0.287-2.082 0.761c-2.039-1.295-4.646-2.069-7.438-2.219 l1.483-4.691l4.062 0.956c0.071 1.4 1.3 2.6 2.7 2.555c1.488 0 2.695-1.208 2.695-2.695C25.881 3.2 24.7 2 23.2 2 c-1.059 0-1.979 0.616-2.42 1.508l-4.633-1.091c-0.344-0.081-0.693 0.118-0.803 0.455l-1.793 5.7 C10.548 8.6 7.7 9.4 5.6 10.75C5.006 10.3 4.3 10 3.5 10.029c-1.785 0-3.237 1.452-3.237 3.2 c0 1.1 0.6 2.1 1.4 2.69c-0.04 0.272-0.061 0.551-0.061 0.831c0 2.3 1.3 4.4 3.7 5.9 c2.299 1.5 5.3 2.3 8.6 2.325c3.228 0 6.271-0.825 8.571-2.325c2.387-1.56 3.7-3.66 3.7-5.917 c0-0.26-0.016-0.514-0.051-0.768C27.088 15.5 27.7 14.4 27.7 13.267z M23.186 3.355c0.74 0 1.3 0.6 1.3 1.3 c0 0.738-0.6 1.34-1.34 1.34s-1.342-0.602-1.342-1.34C21.844 4 22.4 3.4 23.2 3.355z M1.648 13.3 c0-1.038 0.844-1.882 1.882-1.882c0.31 0 0.6 0.1 0.9 0.209c-1.049 0.868-1.813 1.861-2.26 2.9 C1.832 14.2 1.6 13.8 1.6 13.267z M21.773 21.57c-2.082 1.357-4.863 2.105-7.831 2.105c-2.967 0-5.747-0.748-7.828-2.105 c-1.991-1.301-3.088-3-3.088-4.782c0-1.784 1.097-3.484 3.088-4.784c2.081-1.358 4.861-2.106 7.828-2.106 c2.967 0 5.7 0.7 7.8 2.106c1.99 1.3 3.1 3 3.1 4.784C24.859 18.6 23.8 20.3 21.8 21.57z M25.787 14.6 c-0.432-1.084-1.191-2.095-2.244-2.977c0.273-0.156 0.59-0.245 0.928-0.245c1.035 0 1.9 0.8 1.9 1.9 C26.354 13.8 26.1 14.3 25.8 14.605z"/>
											</g>
									</svg>
              </span>
              <span class="text">Reddit</span>
          </a>
      </li>
      <li class="googleplus">
          <a href="https://plus.google.com/share?url=http://chenxiaoyu.org/2011/10/30/nginx-modules/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <g>
                          <path d="M14.703,15.854l-1.219-0.948c-0.372-0.308-0.88-0.715-0.88-1.459c0-0.748,0.508-1.223,0.95-1.663 c1.42-1.119,2.839-2.309,2.839-4.817c0-2.58-1.621-3.937-2.399-4.581h2.097l2.202-1.383h-6.67c-1.83,0-4.467,0.433-6.398,2.027 C3.768,4.287,3.059,6.018,3.059,7.576c0,2.634,2.022,5.328,5.604,5.328c0.339,0,0.71-0.033,1.083-0.068 c-0.167,0.408-0.336,0.748-0.336,1.324c0,1.04,0.551,1.685,1.011,2.297c-1.524,0.104-4.37,0.273-6.467,1.562 c-1.998,1.188-2.605,2.916-2.605,4.137c0,2.512,2.358,4.84,7.289,4.84c5.822,0,8.904-3.223,8.904-6.41 c0.008-2.327-1.359-3.489-2.829-4.731H14.703z M10.269,11.951c-2.912,0-4.231-3.765-4.231-6.037c0-0.884,0.168-1.797,0.744-2.511 c0.543-0.679,1.489-1.12,2.372-1.12c2.807,0,4.256,3.798,4.256,6.242c0,0.612-0.067,1.694-0.845,2.478 c-0.537,0.55-1.438,0.948-2.295,0.951V11.951z M10.302,25.609c-3.621,0-5.957-1.732-5.957-4.142c0-2.408,2.165-3.223,2.911-3.492 c1.421-0.479,3.25-0.545,3.555-0.545c0.338,0,0.52,0,0.766,0.034c2.574,1.838,3.706,2.757,3.706,4.479 c-0.002,2.073-1.736,3.665-4.982,3.649L10.302,25.609z"/>
                          <polygon points="23.254,11.89 23.254,8.521 21.569,8.521 21.569,11.89 18.202,11.89 18.202,13.604 21.569,13.604 21.569,17.004 23.254,17.004 23.254,13.604 26.653,13.604 26.653,11.89"/>
                      </g>
                  </svg>
              </span>
              <span class="text">Google+</span>
          </a>
      </li>
      <li class="pinterest">
          <script>
						var imgurl = "http:\/\/chenxiaoyu.org\/logo.png";
						var firstimg = document.getElementsByClassName("2011")[0].getElementsByTagName("img")[0];
						if (firstimg !== undefined) {
							imgurl = firstimg.src;
						}
						document.write('<a href="http://pinterest.com/pin/create/button/?url=http:\/\/chenxiaoyu.org\/2011\/10\/30\/nginx-modules\/&amp;media=' + imgurl + '&amp;description=Nginx 第三方模块试用记" class="popup">');
					</script>
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
		                  <path d="M14.021,1.57C6.96,1.57,1.236,7.293,1.236,14.355c0,7.062,5.724,12.785,12.785,12.785c7.061,0,12.785-5.725,12.785-12.785 C26.807,7.294,21.082,1.57,14.021,1.57z M15.261,18.655c-1.161-0.09-1.649-0.666-2.559-1.219c-0.501,2.626-1.113,5.145-2.925,6.458 c-0.559-3.971,0.822-6.951,1.462-10.116c-1.093-1.84,0.132-5.545,2.438-4.632c2.837,1.123-2.458,6.842,1.099,7.557 c3.711,0.744,5.227-6.439,2.925-8.775c-3.325-3.374-9.678-0.077-8.897,4.754c0.19,1.178,1.408,1.538,0.489,3.168 C7.165,15.378,6.53,13.7,6.611,11.462c0.131-3.662,3.291-6.227,6.46-6.582c4.007-0.448,7.771,1.474,8.29,5.239 c0.579,4.255-1.816,8.865-6.102,8.533L15.261,18.655z"/>
                  </svg>
              </span>
              <span class="text">Pinterest</span>
          <script>document.write('</a>');</script>
      </li>
      <li class="pocket">
          <a href="https://getpocket.com/save?url=http://chenxiaoyu.org/2011/10/30/nginx-modules/"  class="popup">
              <span class="icon">
                  <svg width="32px" height="28px" viewBox="0 0 32 28" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                      <path d="M28.7817528,0.00172488695 C30.8117487,0.00431221738 31.9749312,1.12074529 31.9644402,3.10781507 C31.942147,6.67703739 32.1336065,10.2669583 31.8057648,13.8090137 C30.7147076,25.5813672 17.2181194,31.8996281 7.20714461,25.3808491 C2.71833574,22.4571656 0.196577202,18.3122624 0.0549495772,12.9357897 C-0.0342233715,9.5774348 0.00642900214,6.21519891 0.0300336062,2.85555035 C0.0405245414,1.1129833 1.21157517,0.0146615391 3.01995012,0.00819321302 C7.34746087,-0.00603710433 11.6775944,0.00431221738 16.0064164,0.00172488695 C20.2644248,0.00172488695 24.5237444,-0.00215610869 28.7817528,0.00172488695 L28.7817528,0.00172488695 Z M8.64885184,7.85611511 C7.38773662,7.99113854 6.66148108,8.42606978 6.29310958,9.33228474 C5.90114134,10.2969233 6.17774769,11.1421181 6.89875951,11.8276216 C9.35282156,14.161969 11.8108164,16.4924215 14.2976518,18.7943114 C15.3844131,19.7966007 16.5354102,19.7836177 17.6116843,18.7813283 C20.0185529,16.5495467 22.4070683,14.2982907 24.7824746,12.0327533 C25.9845979,10.8850542 26.1012707,9.56468083 25.1469132,8.60653379 C24.1361858,7.59255976 22.8449191,7.6743528 21.5890476,8.85191291 C19.9936451,10.3488554 18.3680912,11.8172352 16.8395462,13.3777945 C16.1342655,14.093159 15.7200114,14.0048744 15.0566806,13.3440386 C13.4599671,11.7484252 11.8081945,10.2060421 10.1262706,8.70001155 C9.65564653,8.27936164 9.00411403,8.05345704 8.64885184,7.85611511 L8.64885184,7.85611511 L8.64885184,7.85611511 Z"></path>
                  </svg>
              </span>
              <span class="text">Pocket</span>
          </a>
      </li>
  </ul>
</div>

    <div itemprop="author" itemscope itemtype="http://schema.org/Person">
  <h5>A propos de l'auteur</h5>
  <section>
    <p><a href="http://profiles.google.com/thibault.normand?rel=author" itemprop="name" rel="author">Thibault Normand</a> est un dévéloppeur et un bloggeur enthousiaste, curieux de toutes nouvelles technologies liées à la sécurité, l'architecture, et le
      web. <a href="http://zenithar.org/" rel="me">Plus d'infos...</a>
    </p>
  </section>
</div>
    <div id="comments">
    
    
    
    
</div>

</article>

</main>
		<footer id="footer">
			<section id="footer-message">&copy; smallfish&#39;s blog. All rights reserved. Powered by <a href="http://gohugo.io" target="_blank">Hugo</a>. <a href="https://github.com/kathyqian/crisp-ghost-theme" target="_blank">Crisp</a> theme by <a href="http://kathyqian.com" target="_blank">Kathy Qian</a>.</section>
		</footer>

    <script>
      (function(c,f){asyncLoader=function(i,h){i.foreach(function(k,j){e(j,d(j),h)});if(typeof h.callback=="function"){var g=setInterval(function(){if(f.readyState==="complete"){clearInterval(g);h.callback()}},10)}};var d=function(g){var h=g.split(".");return h[h.length-1]},e=function(h,i,g){switch(i){case"js":a(h,g);break;case"css":b(h);break;default:break}},a=function(i,h){var g=document.createElement("script");g.type="text/javascript";g.async=true;g.src=i;document.getElementsByTagName("head")[0].appendChild(g)},b=function(g){var h=document.createElement("link");h.type="text/css";h.rel="stylesheet";h.href=g;document.getElementsByTagName("head")[0].appendChild(h)};Array.prototype.foreach=function(h){for(var g=0;g<this.length;g++){h(g,this[g])}}})(this,document);

      var WebFontConfig={google:{families:["Open Sans:300italic,700italic,300,700","Bree+Serif"]}};
      asyncLoader([
        "//netdna.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.css",
        "//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js",
        "//cdnjs.cloudflare.com/ajax/libs/webfont/1.5.16/webfontloader.js",
        "//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"
      ],{
        callback:function(){
          asyncLoader([
            "http:\/\/chenxiaoyu.org\/css/rrssb.css",
            "http:\/\/chenxiaoyu.org\/js/gist.min.js", 
            "http:\/\/chenxiaoyu.org\/js/rrssb.min.js",
            "//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css"
          ], { callback:function() {
              hljs.initHighlighting();
          }});
        }
      });
    </script>
	
	</body>
</html>
