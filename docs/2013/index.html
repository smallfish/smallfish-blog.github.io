<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="pinterest" content="nopin">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<meta name="generator" content="Hugo 0.25.1" />

<link rel="alternate" type="application/rss+xml" title="RSS" href="http://chenxiaoyu.org/2013/index.xml">

<link rel="canonical" href="http://chenxiaoyu.org/2013/">


    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/styles/solarized_dark.min.css">
    <title>2013s - smallfish&#39;g blog</title>
    
    <link href="http://chenxiaoyu.org/css/styles.css" rel="stylesheet">
    

  </head>

  <body>
    
    
    

    <header class="l-header">
      <nav class="navbar navbar-default">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://chenxiaoyu.org/">smallfish&#39;g blog</a>
          </div>

          

        </div>
      </nav>
    </header>

    <main>
      <div class="container">
        
<div class="row">
  <div class="col-md-8">

    
    <header class="page-header">
      <h1>2013s</h1>
    </header>
    

    <ul class="p-articles">
      
      <li><article class="li">
  <header>
    <ul class="p-facts">
      <li><i class="fa fa-calendar" aria-hidden="true"></i><time datetime="2013-12-04T00:00:00JST">Dec 4, 2013</time></li>
      <li><i class="fa fa-bookmark" aria-hidden="true"></i><a href="http://chenxiaoyu.org/2013/">2013</a></li>
      
    </ul>
    <h2 class="title"><a href="http://chenxiaoyu.org/2013/12/04/test-nginx/">Test::Nginx 模块介绍</a></h2>
  </header>

  
  <div class="summary">先说句题外话，Perl的测试模块那真是相当的爽，不仅可以爽到无与伦比的正则，还可以对测试用例自由组合、乱序运行等等。
Perl测试模块大概有如下：
 Test::Simple Test::More Test::Base 及衍生（这个我还没搞透）  一般Perl的测试用例，会在一个叫t/的目录下，一堆叫*.t的文件，其实就是普通的Perl脚本。
来段最简单的测试代码：
$ cat 1.t use Test::Simple tests=&gt;2; ok(1 + 1 == 2, &quot;test1 true&quot;); ok(&quot;10&quot; == 10, &quot;test2 true&quot;); $ perl 1.t 1..2 ok 1 - test1 true ok 2 - test2 true  Test::Simple模块只有一个ok()函数，需要复杂的一些的话就用Test::More吧。
跑偏题太远了，回到本文要介绍的Test::Nginx模块。个人觉得这个测试适用于以下场景：
 Nginx测试，包括：自身、模块、配置等测试 反向代理测试，比如后端的HTTP或者其他服务  安装可以用cpan或者直接clone一份Test::Nginx，库地址：https://github.com/agentzh/test-nginx
文档：
 http://search.cpan.org/~agent/Test-Nginx-0.22/lib/Test/Nginx.pm  摘抄模块中的一段测试用例：
use Test::Nginx::Socket; repeat_each(1); plan tests =&gt; 2 * repeat_each() * blocks(); $ENV{TEST_NGINX_MEMCACHED_PORT} ||= 11211; # make this env take a default value run_tests(); __DATA__ === TEST 1: sanity --- config location /foo { set $memc_cmd set; set $memc_key foo; set $memc_value bar; memc_pass 127.</div>

  <footer>
    <a href="http://chenxiaoyu.org/2013/12/04/test-nginx/" title="Test::Nginx 模块介绍">Read More…</a>
  </footer>
</article>
</li>
      
      <li><article class="li">
  <header>
    <ul class="p-facts">
      <li><i class="fa fa-calendar" aria-hidden="true"></i><time datetime="2013-11-28T00:00:00JST">Nov 28, 2013</time></li>
      <li><i class="fa fa-bookmark" aria-hidden="true"></i><a href="http://chenxiaoyu.org/2013/">2013</a></li>
      
    </ul>
    <h2 class="title"><a href="http://chenxiaoyu.org/2013/11/28/postgresql-array/">PostgreSQL ARRAY 数据类型</a></h2>
  </header>

  
  <div class="summary">刚好手头有一个需求，是涉及到数组类型的，懒的插入多条数据库记录，想起了ARRAY数据类型。
官方文档参考：
 8.14. Arrays 9.17. Array Functions and Operators  这里简单的介绍下和一些示例，完整的还是推荐参考官方吧。测试版本为：PostgreSQL 9.3
比如声明integer/varchar数组：
x integer[5] y varchar[] z varchar ARRAY  后两个声明等价，懒人的话就别指明ARRAY长度了，建一个表来玩玩吧。
CREATE TABLE test1 ( x integer[5], y varchar[], z varchar ARRAY ); smallfish=# \d test1 Table &quot;public.test1&quot; Column | Type | Modifiers --------+---------------------+----------- x | integer[] | y | character varying[] | z | character varying[] | 没骗你们吧，后两者完全一样。  写入ARRAY字段，有一下两种方式：
 显示声明，比如：ARRAY[11, 22] 花括号，比如：&rsquo;{aa, bb}&rsquo;  插入一条记录：</div>

  <footer>
    <a href="http://chenxiaoyu.org/2013/11/28/postgresql-array/" title="PostgreSQL ARRAY 数据类型">Read More…</a>
  </footer>
</article>
</li>
      
      <li><article class="li">
  <header>
    <ul class="p-facts">
      <li><i class="fa fa-calendar" aria-hidden="true"></i><time datetime="2013-11-03T00:00:00JST">Nov 3, 2013</time></li>
      <li><i class="fa fa-bookmark" aria-hidden="true"></i><a href="http://chenxiaoyu.org/2013/">2013</a></li>
      
    </ul>
    <h2 class="title"><a href="http://chenxiaoyu.org/2013/11/03/hangzhou-malasong/">我的第一次马拉松（近期跑步总结）</a></h2>
  </header>

  
  <div class="summary">今年博客写的相当少，今天再来一篇非技术内容吧，源于今天刚好跑完了杭州马拉松（半马）。今年7月份开始计划跑步，从最初的4圈就气喘吁吁快跪的样子，一步一步的熬到现在可以轻松跑完10公里，当然仅仅是慢跑的水平。
凭着一时冲动报名了半马（21km），虽然在规定的时间（3小时）内跑完，还是觉得跟自己最初的目标有点差距来着，原计划2小时跑完，结果跑完已经超过20多分钟。不过也是有原因的，简单总结一下吧。
首先，说到准备。今天算起来今天准备阶段做的太差了，浪费了太多时间和体力。
 应该提前半小时到达赛场，换好和存放好衣服，然后做一些热身和拉伸动作，今天完全没热身就上场了。 马拉松由于人数众多，起跑阶段尽量选择道路边缘，可以避免被人来回挤和超出，影响自己。当然要注意路道情况，别崴脚什么的。 上下坡的速度调整，下坡虽然感觉快和轻松，其实是相对的，收不住的话，上坡会发觉很累。 轻装上阵，能不带的尽量不带，建议就带一个电子表，能看时间即可。手机啊，GPS啊什么的，虽然方便，跑到最后发现这些个玩意都是累赘，尤其是长距离跑。 小装备要准备充足，比如：创可贴（避免x处摩擦）、凡士林（同摩擦）、腰包（装点小东西）、面纸（防止中途意外xx）、吃喝能量（运动饮料，巧克力之类）补充。 合理安排跑步和休息计划，比如：大致距离的时速，休息时间等。 跑步节奏，身体和呼吸的调整。千万要稳住，不要和身边的人做比较，自己的身体只有自己知道。跑不动咱就快走来放松一下。  说了这么多，基本都是今天碰到的问题。有兴趣的朋友可以参考 @跑步指南 的一些微博，里面有备战马拉松的一些计划，写的相当不错。
再说一下，关于跑步我自己的一些感受吧。
 装备
 鞋子，最最重要了。平时公路跑或者跑圈，推荐缓冲避震型的跑鞋。Asics有好多入门级的跑鞋，避免对膝盖造成过大的冲击，膝盖歇了，就可以回家躺着了。。。 衣服，速干衣，主要也是为了不吸汗。不要选择太紧或者太松的衣服，长距离时候要么摩擦太大，要么紧身勒的很累（光好看没P用啊）。 其他配件，袜子和护膝什么的。袜子选择稍微厚一些的运动袜，护膝不要买太紧，以免影响腿部肌肉和血液循环。  计划
 跑步间隔，比如跑一休一，这个根据身体自己和运动程度来调节，一周跑个3-4次。“科学证明”跑步间隔不宜超过3天，碰到长假什么的，自己安排个短距离的跑步，找找状态。 运动量，初期可以选择5-10km的匀速跑。 LSD，这个就跟自己的目标有关，每周尽量来一次“长距离慢跑”，速度慢于平时，追求持久。距离大于平时距离的50%左右，初期不能太大，别翻倍。。。。 贵在坚持啊。。。。。三天打鱼两天晒网，有可能前面白跑了。 变速跑，如果只是一味的匀速跑，距离是远了。但是你有可能只是长距离慢跑者。。   半马跑完了，突然对两月后的厦门全马忧心忡忡啊。。亚历山大，看来要安排科学的计划了。</div>

  <footer>
    <a href="http://chenxiaoyu.org/2013/11/03/hangzhou-malasong/" title="我的第一次马拉松（近期跑步总结）">Read More…</a>
  </footer>
</article>
</li>
      
      <li><article class="li">
  <header>
    <ul class="p-facts">
      <li><i class="fa fa-calendar" aria-hidden="true"></i><time datetime="2013-09-12T00:00:00JST">Sep 12, 2013</time></li>
      <li><i class="fa fa-bookmark" aria-hidden="true"></i><a href="http://chenxiaoyu.org/2013/">2013</a></li>
      
    </ul>
    <h2 class="title"><a href="http://chenxiaoyu.org/2013/09/12/python-testing/">Python Testing</a></h2>
  </header>

  
  <div class="summary">代码写多了越发觉得测试的重要性，之前一直喜欢“目测”的做法已经不值得推荐了。当然，这只是一个玩笑。
在Python代码里测试大概有这么几种：doctest、unittest和nose（第三方工具）。
个人推荐nose，简单的话doctest也已经足够了。
首先：
 代码要易于测试，代码写完对应的测试应该配套跟上。 测试要简单，轻便。  先说最简单的doctest吧，顾名思义，doctest就是在文档（docstring）里完成测试。看以下例子（/tmp/1.py）：
def add(a, b): &quot;&quot;&quot; &gt;&gt;&gt; add(10, 20) 30 &quot;&quot;&quot; return a + b if __name__ == &#39;__main__&#39;: import doctest doctest.testmod()  可以看出doctest是不是很简单？是不是想起了普通解释器（&gt;&gt;&gt;），运行一下测试（注意-v选项）：
smallfish@debian:~$ python /tmp/1.py -v Trying: add(10, 20) Expecting: 30 ok 1 items had no tests: __main__ 1 items passed all tests: 1 tests in __main__.add 1 tests in 2 items. 1 passed and 0 failed. Test passed.  作为简单的模块或者工具，main里实现测试已经足够了。但是稍大一些工程或应用，doctest太多的话，看上去会觉得有点臃肿。</div>

  <footer>
    <a href="http://chenxiaoyu.org/2013/09/12/python-testing/" title="Python Testing">Read More…</a>
  </footer>
</article>
</li>
      
      <li><article class="li">
  <header>
    <ul class="p-facts">
      <li><i class="fa fa-calendar" aria-hidden="true"></i><time datetime="2013-08-28T00:00:00JST">Aug 28, 2013</time></li>
      <li><i class="fa fa-bookmark" aria-hidden="true"></i><a href="http://chenxiaoyu.org/2013/">2013</a></li>
      
    </ul>
    <h2 class="title"><a href="http://chenxiaoyu.org/2013/08/28/python-profile/">Python Profile 工具性能分析</a></h2>
  </header>

  
  <div class="summary">最近碰到“程序速度大大降低”的说法，还是直接用数据说明比较有信服力，以及可以找出真正问题所在。
Python自带了几个性能分析的模块：profile、cProfile和hotshot，使用方法基本都差不多，无非模块是纯Python还是用C写的。
官网文档参考：http://docs.python.org/2/library/profile.html
本文示例基于cProfile模块，先写点测试代码（test1.py）：
import time def func1(): sum = 0 for i in range(1000000): sum += i def func2(): time.sleep(10) func1() func2()  运行cProfile命令如下：
$ python -m cProfile -o test1.out test1.py  这里是以模块方式直接保存profile结果，当然也可以在程序中引入cProfile模块。
好了，上面的测试程序大概运行10秒左右，可以看下最终的性能分析数据。
$ python -c &quot;import pstats; p=pstats.Stats(&#39;test1.out&#39;); p.print_stats()&quot; Wed Aug 28 22:19:45 2013 test1.out 6 function calls in 10.163 seconds Random listing order was used ncalls tottime percall cumtime percall filename:lineno(function) 1 0.024 0.024 10.163 10.163 test1.</div>

  <footer>
    <a href="http://chenxiaoyu.org/2013/08/28/python-profile/" title="Python Profile 工具性能分析">Read More…</a>
  </footer>
</article>
</li>
      
      <li><article class="li">
  <header>
    <ul class="p-facts">
      <li><i class="fa fa-calendar" aria-hidden="true"></i><time datetime="2013-03-28T00:00:00JST">Mar 28, 2013</time></li>
      <li><i class="fa fa-bookmark" aria-hidden="true"></i><a href="http://chenxiaoyu.org/2013/">2013</a></li>
      
    </ul>
    <h2 class="title"><a href="http://chenxiaoyu.org/2013/03/28/rabbitmq-http/">RabbitMQ REST API</a></h2>
  </header>

  
  <div class="summary">最近造了一个轮子：rabbitmq-http，源于内部项目的一个翻版。基于 Go 语言实现。
先说说为什么要写 HTTP API，在使用 RabbitMQ 过程中碰到了以下几个问题：
 多语言，这样就要求每个语言都需要安装对应的 amqp 库。 版本，“历史遗留”原因，对应的 amqp 库比较古老，升级不易。 协议实现不全，这个也是跟版本有点关系。 切分和扩展，想自己逻辑里按照用户或 vhost 等来做 hash 切分有点麻烦。 TCP，调试和跟踪不易啊。 功能复杂，对于使用者来说曲线较高，大都数情况只是生产者消费者模型。  其实也不算是问题，就是不爽的地方。也就是想找一个自由度略大的方案，然后使用起来也简单方便。
就整出了一个 HTTP 的方案，刚好最近手痒，想用 Go 语言写点东西，遂趁着周末和晚上整了一下。
仓库地址：https://github.com/smallfish/rabbitmq-http
如何安装依赖、编译和启动这些操作，这里就不再赘述，直接参考项目里的 README.md
目前封装的接口大致分为一下几类：
 Exchange  新建 删除  Queue  新建 删除 绑定/取消绑定 读取消息  Message  发布新消息   上面的新建、删除、发送或者读取的行为对应 HTTP 请求中的几种方法，比如：POST、DELETE、GET等。
整个 API 的返回值（HTTP状态码）有一下三类：
 200，操作 OK，返回的 Body 体中有简单描述字符。 405，不支持的请求方式，比如接口尚未实现。 500，服务器端错误，Body 体中会有错误的描述。比如队列不存在、删除错误等。  好了，还是来一点实际的例子吧。完全是 curl 操作：</div>

  <footer>
    <a href="http://chenxiaoyu.org/2013/03/28/rabbitmq-http/" title="RabbitMQ REST API">Read More…</a>
  </footer>
</article>
</li>
      
    </ul>

    


  </div>
  <div class="col-md-4">
    
<aside class="l-sidebar">

  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">LATESTS</div>
    </div>
    <div class="list-group">
      
      <a href="http://chenxiaoyu.org/2015/01/17/go-flag-multiple-values/" class="list-group-item">Go flag/kingpin 命令行解析多个同名参数</a>
      
      <a href="http://chenxiaoyu.org/2014/12/26/docker-volume-chown/" class="list-group-item">Docker Volume 属主设置</a>
      
      <a href="http://chenxiaoyu.org/2014/11/06/organizing-go-code/" class="list-group-item">翻译-如何组织Go代码</a>
      
      <a href="http://chenxiaoyu.org/2014/07/25/postgresql-json/" class="list-group-item">PostgreSQL JSON 数据类型</a>
      
      <a href="http://chenxiaoyu.org/2013/12/04/test-nginx/" class="list-group-item">Test::Nginx 模块介绍</a>
      
      <a href="http://chenxiaoyu.org/2013/11/28/postgresql-array/" class="list-group-item">PostgreSQL ARRAY 数据类型</a>
      
      <a href="http://chenxiaoyu.org/2013/11/03/hangzhou-malasong/" class="list-group-item">我的第一次马拉松（近期跑步总结）</a>
      
      <a href="http://chenxiaoyu.org/2013/09/12/python-testing/" class="list-group-item">Python Testing</a>
      
      <a href="http://chenxiaoyu.org/2013/08/28/python-profile/" class="list-group-item">Python Profile 工具性能分析</a>
      
      <a href="http://chenxiaoyu.org/2013/03/28/rabbitmq-http/" class="list-group-item">RabbitMQ REST API</a>
      
    </div>
  </section>

  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">CATEGORY</div>
    </div>
    <div class="list-group">
      
    </div>
  </section>
  
  <section class="panel panel-default">
    <div class="panel-heading">
      <div class="panel-title">TAG</div>
    </div>
    <div class="list-group">
      
      <a href="http://chenxiaoyu.org/tags/go" class="list-group-item">go</a>
      
      <a href="http://chenxiaoyu.org/tags/golang" class="list-group-item">golang</a>
      
    </div>
  </section>
  

</aside>


  </div>
</div>

      </div>
    </main>

    <footer class="l-footer">
      <div class="container">
        <p><span class="h-logo">&copy; smallfish&#39;g blog</span></p>
        <aside>
          <p>Powered by <a href="https://gohugo.io/">Hugo</a>.</p>
          <p><a href="https://github.com/dim0627/hugo_theme_beg">Beg</a> designed by <a href="http://yet.unresolved.xyz/">Daisuke Tsuji</a>.</p>
        </aside>
      </div>
    </footer>

    <script src="//code.jquery.com/jquery-3.1.1.min.js"></script>
    <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.4/highlight.min.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>

