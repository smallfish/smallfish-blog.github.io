
<!DOCTYPE html>
<html lang="zh-CN">

    <head>

        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />

        <meta property="og:title" content=" Pylons 入门实例教程 – 数据库操作 &middot;  smallfish&#39;s blog" />
        <meta property="og:site_name" content="smallfish&#39;s blog" />
        <meta property="og:url" content="http://chenxiaoyu.org/2010/07/01/pylons-tutorial-database/" />

    
        <meta property="og:type" content="article" />
        <meta property="og:article:published_time" content="2010-07-01T00:00:00Z" />
        

        <meta name="twitter:card" content="summary" />
        <meta name="twitter:site" content="@" />
        <meta name="twitter:creator" content="@" />
        <meta name="twitter:title" content="Pylons 入门实例教程 – 数据库操作" />
        <meta name="twitter:description" content="" />
        <meta name="twitter:url" content="http://chenxiaoyu.org/2010/07/01/pylons-tutorial-database/" />
    

        <title> Pylons 入门实例教程 – 数据库操作 &middot;  smallfish&#39;s blog</title>

    
        <meta name="description" content="" />
    
        
        <meta name="p:domain_verify" content="fc173d84e3a4de948ed4bda2908afd3e"/>
        <meta name="HandheldFriendly" content="True" />
        <meta name="MobileOptimized" content="320" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />

        
          

    
        <link href="http://chenxiaoyu.org/index.xml" rel="alternate" type="application/rss+xml" title="smallfish&#39;s blog" />
    

    
        <link rel="canonical" href="http://chenxiaoyu.org/2010/07/01/pylons-tutorial-database/" />

    
    <script type="application/ld+json">
    { 
        "@context": "http://schema.org",
        "@type": "Article",
        "headline": "Pylons 入门实例教程 – 数据库操作",
        "author": {
            "@type": "Person",
            "name": "http://profiles.google.com/?rel=author"
        },
        "datePublished": "2010-07-01",
        "description": "",
        "wordCount": 544
    }
    </script>
    
    
    <style>
*{padding:0;margin:0}body,html{font-size:1em;line-height:1.65em;font-family:"Open Sans",sans-serif;font-weight:300;color:#444}html{height:100%}body{padding:2em 2.5em 1em 20em}header{border-right:1px #eee solid;padding:2em;position:fixed;top:0;left:0;height:100%;width:13.5em}#content{display:block;width:100%}footer{padding:1em 0 2.5em;font-size:.8em;line-height:1.5em;color:#888}article{border-bottom:.1em #eee solid;padding-bottom:1.7em;max-width:56em}h4,h5,h6,hr,p{margin-top:.9em;margin-bottom:.9em}h1,h2,h3,h4,h5,h6{font-family:"Bree Serif",serif;font-weight:400!important}h1{font-size:2.5em;line-height:1.1em;margin-top:.6em;margin-bottom:.6em}h2{font-size:1.9em;line-height:1.2em;margin-top:.7em;margin-bottom:.7em}h3{font-size:1.4em;line-height:1.3em;margin-top:.8em;margin-bottom:.8em}h4{font-size:1.3em}h5{font-size:1.2em}h6{font-size:1.1em}iframe,img{max-width:100%}a{font-weight:700;text-decoration:none;color:#5cc265}a:hover{text-decoration:underline}h1 a,h2 a,h3 a,h4 a,h5 a,h6 a{font-weight:400!important}strong{font-weight:700}blockquote{border-left:.4em solid #eee;padding-left:1.2em;font-size:1.3em}hr{border:0;height:1px;background:#eee}ol,ul{margin-left:3em}code{font-size:1.4em;background:#eee}pre{font-size:.8em;line-height:2em;background:#eee;padding:1em;word-break:break-all;word-wrap:break-word;white-space:pre;white-space:-moz-pre-wrap;white-space:pre-wrap}input{font-size:1em;padding:.3em}header h1{font-size:1.9em;margin-top:.8em;margin-bottom:.6em}header h1 a{color:#444}header h1 a:hover{text-decoration:none}header #logo img{width:9em;height:9em;border-radius:4.5em;-moz-border-radius:4.5em;-webkit-border-radius:4.5em;border:none}#follow-icons{font-size:.7em;margin-top:-.7em;margin-bottom:1.5em}#follow-icons a{color:#ccc}#follow-icons span{vertical-align:top;margin-left:-.15em;margin-right:-.15em}#follow-icons span .fa-stack-1x{font-size:1.05em;line-height:1.9em}header h6{margin-top:.5em}article span.post-stamp{color:#888}h1.post-title{margin-top:.35em;margin-bottom:.6em}h3.post-title{margin-top:.4em;padding-bottom:.9em;border-bottom:1px solid #eee;font-size:1.2em;color:#444}.post-title .feature-star{font-size:.9em}.feature-star,.separator,.taglist{color:#ccc}.taglist a{background-color:#ccc;color:#fff;display:inline-block;line-height:1.5em;padding:.3em .6em;vertical-align:20%;font-size:.5em;font-family:"Open Sans",sans-serif;font-weight:700!important;text-transform:uppercase;letter-spacing:.05em;border-radius:.25em;-moz-border-radius:.25em;-webkit-border-radius:.25em}#social-bar{margin-top:1.5em;background-color:#eee;padding:.5em}#comments{margin-top:.15em;padding-bottom:.2em;border-bottom:1px solid #eee}.pagination{margin-bottom:1em}footer a{font-weight:300;color:#888;text-decoration:underline}footer a:hover{color:#444;text-decoration:none}@media only screen and (min-width:1281px){body,html{font-size:1.1em}}@media only screen and (max-width:800px){body{padding:0}header{border-right:none;border-bottom:1px #eee solid;position:relative;height:auto;width:auto;text-align:center;padding-bottom:1em}#content{margin-left:0;padding:2em 2em 1em;width:auto}footer{padding:0 2.5em 2em}}@media only screen and (max-width:320px){#content,header{padding:1.2em 1.2em .6em}footer{padding:0 1.5em 1.2em}ol,ul{margin-left:2em}}
</style>
    </head>
    <body>
        <header id="header">
            <a id="logo" href="http://chenxiaoyu.org/"><img src="https://avatars1.githubusercontent.com/u/105860?v=3&s=460" alt="smallfish&#39;s blog" /></a>
            <h1><a href="http://chenxiaoyu.org/">smallfish&#39;s blog</a></h1>
            <p></p>

            <div id="follow-icons">
	<a href="http://github.com/smallfish" rel="me"><i class="fa fa-github-square fa-2x"></i></a>
	<a href="http://twitter.com/smallfishxy" rel="me"><i class="fa fa-twitter-square fa-2x"></i></a>
	<a href="http://chenxiaoyu.org/index.xml" rel="me"><i class="fa fa-rss-square fa-2x"></i></a> 
</div>  

            Engineer@Alibaba, Alipay

        </header>

<main id="content">

<article id="" class="2010">
    <div class="post-stamp">
        <time datetime="2010-07-01T00:00:00Z">
            1 Jul 2010
        </time>
        <span class="taglist">
        
        </span>
    </div>
    <h1 class="post-title">Pylons 入门实例教程 – 数据库操作</h1>
    <p>前面两篇入门，讲述了 Pylons 大致开发的流程、表单以及文件上传，思路大致跟传统的开发类似。本篇简单讲述下在 Pylons 如何使用数据库。</p>

<p>本篇侧重点是使用 ORM 框架 <a href="http://www.sqlalchemy.org/">http://www.sqlalchemy.org/</a>。其实本人最早是研究了一下 Storm，后来听虾哥（@marchliu）在应用里不是很爽之，遂关注了下他推荐的 SQLAlchemy。当然，你也可以对应数据库的 DB-API 库来进行操作。</p>

<p>示例代码的数据库是 <a href="http://www.postgresql.org">http://www.postgresql.org</a>。至于 Pg 配置和使用这里不再累赘，请狗之。</p>

<p>Debian/Ubuntu 安装很简单：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="n">sudo</span> <span class="n">aptitude</span> <span class="n">install</span> <span class="n">python</span><span class="o">-</span><span class="n">psycopg2</span>
</code></pre></div>


<p>建立一个测试数据库，比如 test：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="n">smallfish</span><span class="nd">@debian</span><span class="p">:</span><span class="o">~/</span><span class="n">workspace</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">hello</span><span class="err">$</span> <span class="n">su</span> <span class="n">postgres</span>
<span class="n">postgres</span><span class="nd">@debian</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">smallfish</span><span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">hello</span><span class="err">$</span> <span class="n">createdb</span> <span class="o">-</span><span class="n">O</span> <span class="n">smallfish</span> <span class="n">test</span>
<span class="n">postgres</span><span class="nd">@debian</span><span class="p">:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">smallfish</span><span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">hello</span><span class="err">$</span> <span class="nb">exit</span>
<span class="n">smallfish</span><span class="nd">@debian</span><span class="p">:</span><span class="o">~/</span><span class="n">workspace</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">hello</span><span class="err">$</span> <span class="n">psql</span> <span class="o">-</span><span class="n">h</span> <span class="mf">127.0</span><span class="o">.</span><span class="mf">0.1</span> <span class="o">-</span><span class="n">p</span> <span class="mi">5432</span> <span class="o">-</span><span class="n">U</span> <span class="n">smallfish</span> <span class="n">test</span>
<span class="err">用户</span> <span class="n">smallfish</span> <span class="err">的口令：</span>
<span class="n">psql</span> <span class="p">(</span><span class="mf">8.4</span><span class="o">.</span><span class="mi">4</span><span class="p">)</span>
<span class="n">SSL</span><span class="err">连接</span> <span class="p">(</span><span class="err">加密：</span><span class="n">DHE</span><span class="o">-</span><span class="n">RSA</span><span class="o">-</span><span class="n">AES256</span><span class="o">-</span><span class="n">SHA</span><span class="err">，位元：</span><span class="mi">256</span><span class="p">)</span>

<span class="err">输入</span> <span class="s2">&quot;help&quot;</span> <span class="err">来获取帮助信息</span><span class="o">.</span>

<span class="n">test</span><span class="o">=</span><span class="c1">#</span>
</code></pre></div>


<p>数据库的部分已经OK，下面就是来倒腾 Pylons 啦。</p>

<p>建立新项目，加入支持数据库部分，注意 Enter sqlalchemy那个选项，默认是 False，改成 True：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="n">smallfish</span><span class="nd">@debian</span><span class="p">:</span><span class="o">~/</span><span class="n">workspace</span><span class="o">/</span><span class="n">python</span><span class="err">$</span> <span class="n">paster</span> <span class="n">create</span> <span class="o">-</span><span class="n">t</span> <span class="n">pylons</span> <span class="n">hellodb</span>
<span class="n">Selected</span> <span class="ow">and</span> <span class="n">implied</span> <span class="n">templates</span><span class="p">:</span>
  <span class="n">Pylons</span><span class="c1">#pylons  Pylons application template</span>

<span class="n">Variables</span><span class="p">:</span>
  <span class="n">egg</span><span class="p">:</span>      <span class="n">hellodb</span>
  <span class="n">package</span><span class="p">:</span>  <span class="n">hellodb</span>
  <span class="n">project</span><span class="p">:</span>  <span class="n">hellodb</span>
<span class="n">Enter</span> <span class="n">template_engine</span> <span class="p">(</span><span class="n">mako</span><span class="o">/</span><span class="n">genshi</span><span class="o">/</span><span class="n">jinja2</span><span class="o">/</span><span class="n">etc</span><span class="p">:</span> <span class="n">Template</span> <span class="n">language</span><span class="p">)</span> <span class="p">[</span><span class="s1">&#39;mako&#39;</span><span class="p">]:</span>
<span class="n">Enter</span> <span class="n">sqlalchemy</span> <span class="p">(</span><span class="bp">True</span><span class="o">/</span><span class="bp">False</span><span class="p">:</span> <span class="n">Include</span> <span class="n">SQLAlchemy</span> <span class="mf">0.5</span> <span class="n">configuration</span><span class="p">)</span> <span class="p">[</span><span class="bp">False</span><span class="p">]:</span> <span class="bp">True</span>
<span class="n">Creating</span> <span class="n">template</span> <span class="n">pylons</span>
<span class="n">Creating</span> <span class="n">directory</span> <span class="o">./</span><span class="n">hellodb</span>
</code></pre></div>


<p>改成 True 之后在自动生成的 development.ini 里就有对应的数据库配置选项了。</p>

<p>再建立新的 db controller：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="n">smallfish</span><span class="nd">@debian</span><span class="p">:</span><span class="o">~/</span><span class="n">workspace</span><span class="o">/</span><span class="n">python</span><span class="err">$</span> <span class="n">cd</span> <span class="n">hellodb</span><span class="o">/</span>
<span class="n">smallfish</span><span class="nd">@debian</span><span class="p">:</span><span class="o">~/</span><span class="n">workspace</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">hellodb</span><span class="err">$</span> <span class="n">paster</span> <span class="n">controller</span> <span class="n">db</span>
<span class="n">Creating</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">smallfish</span><span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">hellodb</span><span class="o">/</span><span class="n">hellodb</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">db</span><span class="o">.</span><span class="n">py</span>
<span class="n">Creating</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">smallfish</span><span class="o">/</span><span class="n">workspace</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">hellodb</span><span class="o">/</span><span class="n">hellodb</span><span class="o">/</span><span class="n">tests</span><span class="o">/</span><span class="n">functional</span><span class="o">/</span><span class="n">test_db</span><span class="o">.</span><span class="n">py</span>
</code></pre></div>


<p>编辑 development.ini，添加数据库配置部分。smallfish:123456 是对应的 PostgreSQL 用户名/密码，127.0.0.1:5432 是对应的主机地址/端口号，最后的test则是数据库名。</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="c1"># SQLAlchemy database URL</span>
<span class="n">sqlalchemy</span><span class="o">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">postgresql</span><span class="p">:</span><span class="o">//</span><span class="n">smallfish</span><span class="p">:</span><span class="mi">123456</span><span class="nd">@127.0.0.1</span><span class="p">:</span><span class="mi">5432</span><span class="o">/</span><span class="n">test</span>
</code></pre></div>


<p>编辑 hellodb/model/<strong>init</strong>.py，加上一个叫 msg 的表和字段的定义：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="sd">&quot;&quot;&quot;The application&#39;s model objects&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">hellodb.model.meta</span> <span class="kn">import</span> <span class="n">Session</span><span class="p">,</span> <span class="n">metadata</span>

<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">orm</span><span class="p">,</span> <span class="n">schema</span><span class="p">,</span> <span class="n">types</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">def</span> <span class="nf">init_model</span><span class="p">(</span><span class="n">engine</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Call me before using any of the tables or classes in the model&quot;&quot;&quot;</span>
    <span class="n">Session</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">bind</span><span class="o">=</span><span class="n">engine</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">now</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

<span class="n">msg_table</span> <span class="o">=</span> <span class="n">schema</span><span class="o">.</span><span class="n">Table</span><span class="p">(</span><span class="s1">&#39;msg&#39;</span><span class="p">,</span> <span class="n">metadata</span><span class="p">,</span>
    <span class="n">schema</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">schema</span><span class="o">.</span><span class="n">Sequence</span><span class="p">(</span><span class="s1">&#39;msg_seq_id&#39;</span><span class="p">,</span> <span class="n">optional</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">schema</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;content&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">Text</span><span class="p">(),</span> <span class="n">nullable</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
    <span class="n">schema</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="s1">&#39;addtime&#39;</span><span class="p">,</span> <span class="n">types</span><span class="o">.</span><span class="n">DateTime</span><span class="p">(),</span> <span class="n">default</span><span class="o">=</span><span class="n">now</span><span class="p">),</span>
<span class="p">)</span>

<span class="k">class</span> <span class="nc">Msg</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="n">orm</span><span class="o">.</span><span class="n">mapper</span><span class="p">(</span><span class="n">Msg</span><span class="p">,</span> <span class="n">msg_table</span><span class="p">)</span>
</code></pre></div>


<p>示例 Msg 表很简单，三个字段：ID、内容和时间。</p>

<p>上面的代码除去导入 sqlclchemy 包里几个库，基本上有一个对应表的字段定义，还有一个空的 Msg 对象。</p>

<p>最后一行，则是做一个 map 的动作，把 Msg 映射到 msg_table 上。</p>

<p>下面是不是要在数据库里建立对应的表呢？有个简单的办法 可以初始化数据库：paster setup-app development.ini：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="n">smallfish</span><span class="nd">@debian</span><span class="p">:</span><span class="o">~/</span><span class="n">workspace</span><span class="o">/</span><span class="n">python</span><span class="o">/</span><span class="n">hellodb</span><span class="err">$</span> <span class="n">paster</span> <span class="n">setup</span><span class="o">-</span><span class="n">app</span> <span class="n">development</span><span class="o">.</span><span class="n">ini</span>
<span class="n">Running</span> <span class="n">setup_config</span><span class="p">()</span> <span class="kn">from</span> <span class="nn">hellodb.websetup</span>
<span class="mi">20</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">619</span> <span class="n">INFO</span>  <span class="p">[</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Engine</span><span class="o">.</span><span class="mi">0</span><span class="n">x</span><span class="o">...</span><span class="mi">854</span><span class="n">c</span><span class="p">]</span> <span class="p">[</span><span class="n">MainThread</span><span class="p">]</span> <span class="n">select</span> <span class="n">version</span><span class="p">()</span>
<span class="mi">20</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">619</span> <span class="n">INFO</span>  <span class="p">[</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Engine</span><span class="o">.</span><span class="mi">0</span><span class="n">x</span><span class="o">...</span><span class="mi">854</span><span class="n">c</span><span class="p">]</span> <span class="p">[</span><span class="n">MainThread</span><span class="p">]</span> <span class="p">{}</span>
<span class="mi">20</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">625</span> <span class="n">INFO</span>  <span class="p">[</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Engine</span><span class="o">.</span><span class="mi">0</span><span class="n">x</span><span class="o">...</span><span class="mi">854</span><span class="n">c</span><span class="p">]</span> <span class="p">[</span><span class="n">MainThread</span><span class="p">]</span> <span class="n">select</span> <span class="n">current_schema</span><span class="p">()</span>
<span class="mi">20</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">625</span> <span class="n">INFO</span>  <span class="p">[</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Engine</span><span class="o">.</span><span class="mi">0</span><span class="n">x</span><span class="o">...</span><span class="mi">854</span><span class="n">c</span><span class="p">]</span> <span class="p">[</span><span class="n">MainThread</span><span class="p">]</span> <span class="p">{}</span>
<span class="mi">20</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">631</span> <span class="n">INFO</span>  <span class="p">[</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Engine</span><span class="o">.</span><span class="mi">0</span><span class="n">x</span><span class="o">...</span><span class="mi">854</span><span class="n">c</span><span class="p">]</span> <span class="p">[</span><span class="n">MainThread</span><span class="p">]</span> <span class="n">select</span> <span class="n">relname</span> <span class="kn">from</span> <span class="nn">pg_class</span> <span class="nn">c</span> <span class="nn">join</span> <span class="nn">pg_namespace</span> <span class="nn">n</span> <span class="nn">on</span> <span class="nn">n.oid</span><span class="o">=</span><span class="n">c</span><span class="o">.</span><span class="n">relnamespace</span> <span class="n">where</span> <span class="n">n</span><span class="o">.</span><span class="n">nspname</span><span class="o">=</span><span class="n">current_schema</span><span class="p">()</span> <span class="ow">and</span> <span class="n">lower</span><span class="p">(</span><span class="n">relname</span><span class="p">)</span><span class="o">=%</span><span class="p">(</span><span class="n">name</span><span class="p">)</span><span class="n">s</span>
<span class="mi">20</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">631</span> <span class="n">INFO</span>  <span class="p">[</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Engine</span><span class="o">.</span><span class="mi">0</span><span class="n">x</span><span class="o">...</span><span class="mi">854</span><span class="n">c</span><span class="p">]</span> <span class="p">[</span><span class="n">MainThread</span><span class="p">]</span> <span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="sa">u</span><span class="s1">&#39;msg&#39;</span><span class="p">}</span>
<span class="mi">20</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">637</span> <span class="n">INFO</span>  <span class="p">[</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Engine</span><span class="o">.</span><span class="mi">0</span><span class="n">x</span><span class="o">...</span><span class="mi">854</span><span class="n">c</span><span class="p">]</span> <span class="p">[</span><span class="n">MainThread</span><span class="p">]</span>
<span class="n">CREATE</span> <span class="n">TABLE</span> <span class="n">msg</span> <span class="p">(</span>
        <span class="nb">id</span> <span class="n">SERIAL</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
        <span class="n">content</span> <span class="n">TEXT</span> <span class="n">NOT</span> <span class="n">NULL</span><span class="p">,</span>
        <span class="n">addtime</span> <span class="n">TIMESTAMP</span> <span class="n">WITHOUT</span> <span class="n">TIME</span> <span class="n">ZONE</span><span class="p">,</span>
        <span class="n">PRIMARY</span> <span class="n">KEY</span> <span class="p">(</span><span class="nb">id</span><span class="p">)</span>
<span class="p">)</span>

<span class="mi">20</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">637</span> <span class="n">INFO</span>  <span class="p">[</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Engine</span><span class="o">.</span><span class="mi">0</span><span class="n">x</span><span class="o">...</span><span class="mi">854</span><span class="n">c</span><span class="p">]</span> <span class="p">[</span><span class="n">MainThread</span><span class="p">]</span> <span class="p">{}</span>
<span class="mi">20</span><span class="p">:</span><span class="mi">08</span><span class="p">:</span><span class="mi">43</span><span class="p">,</span><span class="mi">732</span> <span class="n">INFO</span>  <span class="p">[</span><span class="n">sqlalchemy</span><span class="o">.</span><span class="n">engine</span><span class="o">.</span><span class="n">base</span><span class="o">.</span><span class="n">Engine</span><span class="o">.</span><span class="mi">0</span><span class="n">x</span><span class="o">...</span><span class="mi">854</span><span class="n">c</span><span class="p">]</span> <span class="p">[</span><span class="n">MainThread</span><span class="p">]</span> <span class="n">COMMIT</span>
</code></pre></div>


<p>可以看到上面的输出日志，包括了建表的SQL语句。其中 SERIAL 对应上面 <strong>init</strong>.py 里 Column 的 Seq 定义。serial 类型 在 PostgreSQL 可以看成类似 MySQL 的自增ID（auto_increment） 。</p>

<p>现在进入 PostgreSQL 查询数据库，就可以看到表以及序列已经建立。</p>

<p><div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="n">test</span><span class="o">=</span><span class="c1"># \d</span>
                  <span class="err">关联列表</span>
 <span class="err">架构模式</span> <span class="o">|</span>    <span class="err">名称</span>    <span class="o">|</span>  <span class="err">型别</span>  <span class="o">|</span>  <span class="err">拥有者</span>
<span class="o">----------+------------+--------+-----------</span>
 <span class="n">public</span>   <span class="o">|</span> <span class="n">msg</span>        <span class="o">|</span> <span class="err">资料表</span> <span class="o">|</span> <span class="n">smallfish</span>
 <span class="n">public</span>   <span class="o">|</span> <span class="n">msg_id_seq</span> <span class="o">|</span> <span class="err">序列数</span> <span class="o">|</span> <span class="n">smallfish</span>
<span class="p">(</span><span class="mi">2</span> <span class="err">行记录</span><span class="p">)</span>
</code></pre></div>
</p>

<p>到这里，准备工作已经完毕，包括了初始化数据库，配置文件还有示例 controller。</p>

<p>下面就在 controller 代码里增加读写数据库的功能吧。</p>

<p>首先建立一个表单模板 db.htm ，用来添加并保存到数据库表中：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="o">&lt;</span><span class="n">form</span> <span class="n">action</span><span class="o">=</span><span class="s2">&quot;/db/add&quot;</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
<span class="err">  </span> <span class="err"> </span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;content&quot;</span> <span class="o">/&gt;</span>
<span class="err">  </span> <span class="err"> </span><span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
<span class="err">  </span> <span class="err"> </span><span class="o">&lt;</span><span class="nb">input</span> <span class="nb">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;save&quot;</span> <span class="o">/&gt;</span>
<span class="o">&lt;/</span><span class="n">form</span><span class="o">&gt;</span>
</code></pre></div>


<p>对应 controller index 修改成，很简单。返回到模板：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="k">class</span> <span class="nc">DbController</span><span class="p">(</span><span class="n">BaseController</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="s1">&#39;/db.htm&#39;</span><span class="p">)</span>
</code></pre></div>


<p>添加 add 方法，对应上面 form 中的 /db/add 路径：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span>    <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">content</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span>
        <span class="kn">from</span> <span class="nn">hellodb</span> <span class="kn">import</span> <span class="n">model</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Msg</span><span class="p">()</span>
        <span class="n">msg</span><span class="o">.</span><span class="n">content</span> <span class="o">=</span> <span class="n">content</span>
        <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">Session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">Session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="s2">&quot;add </span><span class="si">%s</span><span class="s2"> ok...&quot;</span> <span class="o">%</span> <span class="n">content</span>
</code></pre></div>


<p>添加部分简单完成。获取 POST 文本框，然后初始化一个 Msg 对象（上面 model 里定义的）。</p>

<p>注意 add 之后，必须手动 commit，这样才会真正保存到数据库。</p>

<p>浏览器访问一下：<a href="http://127.0.0.1:5000/db/index，随意添加一点数据吧，这个时候你可以在">http://127.0.0.1:5000/db/index，随意添加一点数据吧，这个时候你可以在</a> PostgreSQL 里查询已经数据已经加进来了。</p>

<p>下面在 index 方法传递一些值到模板，输出刚才已经添加的数据：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span>    <span class="k">def</span> <span class="nf">index</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">hellodb</span> <span class="kn">import</span> <span class="n">model</span>
        <span class="n">c</span><span class="o">.</span><span class="n">msgs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">Session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Msg</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="s1">&#39;/db.htm&#39;</span><span class="p">)</span>
</code></pre></div>


<p>c.msgs 可以理解成全局变量，关于 c 的定义在 controller前几行就应该看到了。修改模板 db.htm 显示记录：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="o">%</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">msgs</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">$</span><span class="p">{</span><span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">}:</span> <span class="err">$</span><span class="p">{</span><span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="p">}</span> <span class="o">/</span> <span class="err">$</span><span class="p">{</span><span class="n">msg</span><span class="o">.</span><span class="n">addtime</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="o">%</span> <span class="n">endfor</span>
</code></pre></div>


<p>很简单，只是一个普通 for 循环，遍历 index 方式里传递的 c.msgs。Mako模板还是很易读的吧？</p>

<p>继续刷新下：<a href="http://127.0.0.1:5000/db/index，可以在页面上看到已经添加的数据了。">http://127.0.0.1:5000/db/index，可以在页面上看到已经添加的数据了。</a></p>

<p>在狂输入了几十条之后，在一页里显示是不是忒土鳖了？</p>

<p>下面再介绍下 Pylons 里 webhelper 里一个分页组件的用法，当然你也可以自己写分页算法。下面是示例：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span>    <span class="k">def</span> <span class="nf">list</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">webhelpers</span> <span class="kn">import</span> <span class="n">paginate</span>
        <span class="kn">from</span> <span class="nn">hellodb</span> <span class="kn">import</span> <span class="n">model</span>
        <span class="n">msgs</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">meta</span><span class="o">.</span><span class="n">Session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">Msg</span><span class="p">)</span>
        <span class="n">c</span><span class="o">.</span><span class="n">paginator</span> <span class="o">=</span> <span class="n">paginate</span><span class="o">.</span><span class="n">Page</span><span class="p">(</span>
            <span class="n">msgs</span><span class="p">,</span>
            <span class="n">page</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">params</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;page&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span>
            <span class="n">items_per_page</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="s2">&quot;/list.htm&quot;</span><span class="p">)</span>
</code></pre></div>


<p>导入 paginate，然后把查询的数据库对象当参数传递给 paginate.Page，里面的page则是页面的传递的页数参数，items_per_page 就好理解多了，就是多少条一页。这里是10条。</p>

<p>对应的模板 list.htm 如下：</p>

<div class="highlight"><pre><code class="language-python" data-lang="python"><span></span><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;</span>
<span class="o">%</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">paginator</span><span class="p">):</span>

<span class="o">%</span> <span class="k">for</span> <span class="n">msg</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">paginator</span><span class="p">:</span>
<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="err">$</span><span class="p">{</span><span class="n">msg</span><span class="o">.</span><span class="n">id</span><span class="p">}:</span> <span class="err">$</span><span class="p">{</span><span class="n">msg</span><span class="o">.</span><span class="n">content</span><span class="p">}</span><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="o">%</span> <span class="n">endfor</span>

<span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span> <span class="err">$</span><span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">paginator</span><span class="o">.</span><span class="n">pager</span><span class="p">(</span><span class="s2">&quot;count: $item_count $first_item to $last_item , $link_first $link_previous $link_next $link_last&quot;</span><span class="p">)}</span> <span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
<span class="o">%</span> <span class="n">endif</span>
</code></pre></div>


<p>for 部分如同上面示例，下面加了一行pager。里面一些变量从名字上就可以看出功能了。包括了总条数、当前是第几到第几条，然后就是常用的首页、上页、下页和最后一页。</p>

<p>这里链接的文字都是&lt;&lt;， &lt;， &gt;， &gt;&gt;。想改成文字请查看文档吧。。如果是第一页，是不会显示首页和上一页的。这个做过分页的一般都写过类似的代码吧。</p>

<p>现在访问：<a href="http://127.0.0.1:5000/db/list，想看到效果当然你得多填点数据哦。10条才会显示分页的挖。">http://127.0.0.1:5000/db/list，想看到效果当然你得多填点数据哦。10条才会显示分页的挖。</a></p>

<p>好了，这里对数据库增加和显示部分都已经有示例代码了，当然最后还有一个分页用法。至于删除和更新之类请参考 SQLAlchemy 文档吧。</p>

    <div id="social-bar">
	<ul class="rrssb-buttons clearfix">
      <li class="email">
          <a href="mailto:?subject=Pylons%20%e5%85%a5%e9%97%a8%e5%ae%9e%e4%be%8b%e6%95%99%e7%a8%8b%20%e2%80%93%20%e6%95%b0%e6%8d%ae%e5%ba%93%e6%93%8d%e4%bd%9c&amp;body=http://chenxiaoyu.org/2010/07/01/pylons-tutorial-database/">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path transform="scale(0.014,-0.014) translate(0,-1670)" d="M1792 826v-794q0 -66 -47 -113t-113 -47h-1472q-66 0 -113 47t-47 113v794q44 -49 101 -87q362 -246 497 -345q57 -42 92.5 -65.5t94.5 -48t110 -24.5h1h1q51 0 110 24.5t94.5 48t92.5 65.5q170 123 498 345q57 39 100 87zM1792 1120q0 -79 -49 -151t-122 -123 q-376 -261 -468 -325q-10 -7 -42.5 -30.5t-54 -38t-52 -32.5t-57.5 -27t-50 -9h-1h-1q-23 0 -50 9t-57.5 27t-52 32.5t-54 38t-42.5 30.5q-91 64 -262 182.5t-205 142.5q-62 42 -117 115.5t-55 136.5q0 78 41.5 130t118.5 52h1472q65 0 112.5 -47t47.5 -113z"/>
                  </svg>
              </span>
              <span class="text">Email</span>
          </a>
      </li>
      <li class="facebook">
          <a href="https://www.facebook.com/sharer/sharer.php?u=http://chenxiaoyu.org/2010/07/01/pylons-tutorial-database/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434 c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726 c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"/>
                  </svg>
              </span>
              <span class="text">Facebook</span>
          </a>
      </li>
			<li class="twitter">
          <a href="http://twitter.com/home?status=Pylons%20%e5%85%a5%e9%97%a8%e5%ae%9e%e4%be%8b%e6%95%99%e7%a8%8b%20%e2%80%93%20%e6%95%b0%e6%8d%ae%e5%ba%93%e6%93%8d%e4%bd%9c%20http://chenxiaoyu.org/2010/07/01/pylons-tutorial-database/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
		                  <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32 c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155 C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965 C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683 c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851 C26.275,7.229,25.39,8.196,24.253,8.756z"/>
                  </svg>
              </span>
              <span class="text">Twitter</span>
          </a>
      </li>
			<li class="linkedin">
          <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://chenxiaoyu.org/2010/07/01/pylons-tutorial-database/&amp;title=Pylons%20%e5%85%a5%e9%97%a8%e5%ae%9e%e4%be%8b%e6%95%99%e7%a8%8b%20%e2%80%93%20%e6%95%b0%e6%8d%ae%e5%ba%93%e6%93%8d%e4%bd%9c&amp;summary=%e5%89%8d%e9%9d%a2%e4%b8%a4%e7%af%87%e5%85%a5%e9%97%a8%ef%bc%8c%e8%ae%b2%e8%bf%b0%e4%ba%86%20Pylons%20%e5%a4%a7%e8%87%b4%e5%bc%80%e5%8f%91%e7%9a%84%e6%b5%81%e7%a8%8b%e3%80%81%e8%a1%a8%e5%8d%95%e4%bb%a5%e5%8f%8a%e6%96%87%e4%bb%b6%e4%b8%8a%e4%bc%a0%ef%bc%8c%e6%80%9d%e8%b7%af%e5%a4%a7%e8%87%b4%e8%b7%9f%e4%bc%a0%e7%bb%9f%e7%9a%84%e5%bc%80%e5%8f%91%e7%b1%bb%e4%bc%bc%e3%80%82%e6%9c%ac%e7%af%87%e7%ae%80%e5%8d%95%e8%ae%b2%e8%bf%b0%e4%b8%8b%e5%9c%a8%20Pylons%20%e5%a6%82%e4%bd%95%e4%bd%bf%e7%94%a8%e6%95%b0%e6%8d%ae%e5%ba%93%e3%80%82%0a%e6%9c%ac%e7%af%87%e4%be%a7%e9%87%8d%e7%82%b9%e6%98%af%e4%bd%bf%e7%94%a8%20ORM%20%e6%a1%86%e6%9e%b6%20http%3a%2f%2fwww.sqlalchemy.org%2f%e3%80%82%e5%85%b6%e5%ae%9e%e6%9c%ac%e4%ba%ba%e6%9c%80%e6%97%a9%e6%98%af%e7%a0%94%e7%a9%b6%e4%ba%86%e4%b8%80%e4%b8%8b%20Storm%ef%bc%8c%e5%90%8e%e6%9d%a5%e5%90%ac%e8%99%be%e5%93%a5%ef%bc%88%40marchliu%ef%bc%89%e5%9c%a8%e5%ba%94%e7%94%a8%e9%87%8c%e4%b8%8d%e6%98%af%e5%be%88%e7%88%bd%e4%b9%8b%ef%bc%8c%e9%81%82%e5%85%b3%e6%b3%a8%e4%ba%86%e4%b8%8b%e4%bb%96%e6%8e%a8%e8%8d%90%e7%9a%84%20SQLAlchemy%e3%80%82%e5%bd%93%e7%84%b6%ef%bc%8c%e4%bd%a0%e4%b9%9f%e5%8f%af%e4%bb%a5%e5%af%b9%e5%ba%94%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%20DB-API%20%e5%ba%93%e6%9d%a5%e8%bf%9b%e8%a1%8c%e6%93%8d%e4%bd%9c%e3%80%82%0a%e7%a4%ba%e4%be%8b%e4%bb%a3%e7%a0%81%e7%9a%84%e6%95%b0%e6%8d%ae%e5%ba%93%e6%98%af%20http%3a%2f%2fwww.postgresql.org%e3%80%82%e8%87%b3%e4%ba%8e%20Pg%20%e9%85%8d%e7%bd%ae%e5%92%8c%e4%bd%bf%e7%94%a8%e8%bf%99%e9%87%8c%e4%b8%8d%e5%86%8d%e7%b4%af%e8%b5%98%ef%bc%8c%e8%af%b7%e7%8b%97%e4%b9%8b%e3%80%82%0aDebian%2fUbuntu%20%e5%ae%89%e8%a3%85%e5%be%88%e7%ae%80%e5%8d%95%ef%bc%9a%0asudo%20aptitude%20install%20python-psycopg2%20%20%e5%bb%ba%e7%ab%8b%e4%b8%80%e4%b8%aa%e6%b5%8b%e8%af%95%e6%95%b0%e6%8d%ae%e5%ba%93%ef%bc%8c%e6%af%94%e5%a6%82%20test%ef%bc%9a%0asmallfish%40debian%3a~%2fworkspace%2fpython%2fhello%24%20su%20postgres%20postgres%40debian%3a%2fhome%2fsmallfish%2fworkspace%2fpython%2fhello%24%20createdb%20-O%20smallfish%20test%20postgres%40debian%3a%2fhome%2fsmallfish%2fworkspace%2fpython%2fhello%24%20exit%20smallfish%40debian%3a~%2fworkspace%2fpython%2fhello%24%20psql%20-h%20127.0.0.1%20-p%205432%20-U%20smallfish%20test%20%e7%94%a8%e6%88%b7%20smallfish%20%e7%9a%84%e5%8f%a3%e4%bb%a4%ef%bc%9a%20psql%20%288.4.4%29%20SSL%e8%bf%9e%e6%8e%a5%20%28%e5%8a%a0%e5%af%86%ef%bc%9aDHE-RSA-AES256-SHA%ef%bc%8c%e4%bd%8d%e5%85%83%ef%bc%9a256%29%20%e8%be%93%e5%85%a5%20%26quot%3bhelp%26quot%3b%20%e6%9d%a5%e8%8e%b7%e5%8f%96%e5%b8%ae%e5%8a%a9%e4%bf%a1%e6%81%af.%20test%3d%23%20%20%e6%95%b0%e6%8d%ae%e5%ba%93%e7%9a%84%e9%83%a8%e5%88%86%e5%b7%b2%e7%bb%8fOK%ef%bc%8c%e4%b8%8b%e9%9d%a2%e5%b0%b1%e6%98%af%e6%9d%a5%e5%80%92%e8%85%be%20Pylons%20%e5%95%a6%e3%80%82%0a%e5%bb%ba%e7%ab%8b%e6%96%b0%e9%a1%b9%e7%9b%ae%ef%bc%8c%e5%8a%a0%e5%85%a5%e6%94%af%e6%8c%81%e6%95%b0%e6%8d%ae%e5%ba%93%e9%83%a8%e5%88%86%ef%bc%8c%e6%b3%a8%e6%84%8f%20Enter%20sqlalchemy%e9%82%a3%e4%b8%aa%e9%80%89%e9%a1%b9%ef%bc%8c%e9%bb%98%e8%ae%a4%e6%98%af%20False%ef%bc%8c%e6%94%b9%e6%88%90%20True%ef%bc%9a%0asmallfish%40debian%3a~%2fworkspace%2fpython%24%20paster%20create%20-t%20pylons%20hellodb%20Selected%20and%20implied%20templates%3a%20Pylons%23pylons%20Pylons%20application%20template%20Variables%3a%20egg%3a%20hellodb%20package%3a%20hellodb%20project%3a%20hellodb%20Enter%20template_engine%20%28mako%2fgenshi%2fjinja2%2fetc%3a%20Template%20language%29%20%5b%26%2339%3bmako%26%2339%3b%5d%3a%20Enter%20sqlalchemy%20%28True%2fFalse%3a%20Include%20SQLAlchemy%200...." class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <path d="M25.424,15.887v8.447h-4.896v-7.882c0-1.979-0.709-3.331-2.48-3.331c-1.354,0-2.158,0.911-2.514,1.803 c-0.129,0.315-0.162,0.753-0.162,1.194v8.216h-4.899c0,0,0.066-13.349,0-14.731h4.899v2.088c-0.01,0.016-0.023,0.032-0.033,0.048 h0.033V11.69c0.65-1.002,1.812-2.435,4.414-2.435C23.008,9.254,25.424,11.361,25.424,15.887z M5.348,2.501 c-1.676,0-2.772,1.092-2.772,2.539c0,1.421,1.066,2.538,2.717,2.546h0.032c1.709,0,2.771-1.132,2.771-2.546 C8.054,3.593,7.019,2.501,5.343,2.501H5.348z M2.867,24.334h4.897V9.603H2.867V24.334z"/>
                  </svg>
              </span>
              <span class="text">LinkedIn</span>
          </a>
      </li>
      <li class="tumblr">
					<script>
						document.write('<a href="http://www.tumblr.com/share?v=3&amp;u=' + encodeURIComponent('http:\/\/chenxiaoyu.org\/2010\/07\/01\/pylons-tutorial-database\/') + '&amp;t=Pylons 入门实例教程 – 数据库操作" class="popup">');
					</script>
              <span class="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
											<path d="M18.02 21.842c-2.029 0.052-2.422-1.396-2.439-2.446v-7.294h4.729V7.874h-4.71V1.592c0 0-3.653 0-3.714 0 s-0.167 0.053-0.182 0.186c-0.218 1.935-1.144 5.33-4.988 6.688v3.637h2.927v7.677c0 2.8 1.7 6.7 7.3 6.6 c1.863-0.03 3.934-0.795 4.392-1.453l-1.22-3.539C19.595 21.6 18.7 21.8 18 21.842z"/>
									</svg>
              </span>
              <span class="text">Tumblr</span>
          <script>document.write('</a>');</script>
      </li>
      <li class="reddit">
          <a href="http://www.reddit.com/submit?url=http://chenxiaoyu.org/2010/07/01/pylons-tutorial-database/">
              <span class="icon">
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
											<g>
													<path d="M11.794 15.316c0-1.029-0.835-1.895-1.866-1.895c-1.03 0-1.893 0.865-1.893 1.895s0.863 1.9 1.9 1.9 C10.958 17.2 11.8 16.3 11.8 15.316z"/>
													<path d="M18.1 13.422c-1.029 0-1.895 0.864-1.895 1.895c0 1 0.9 1.9 1.9 1.865c1.031 0 1.869-0.836 1.869-1.865 C19.969 14.3 19.1 13.4 18.1 13.422z"/>
													<path d="M17.527 19.791c-0.678 0.678-1.826 1.006-3.514 1.006c-0.004 0-0.009 0-0.014 0c-0.004 0-0.01 0-0.015 0 c-1.686 0-2.834-0.328-3.51-1.005c-0.264-0.265-0.693-0.265-0.958 0c-0.264 0.265-0.264 0.7 0 1 c0.943 0.9 2.4 1.4 4.5 1.402c0.005 0 0 0 0 0c0.005 0 0 0 0 0c2.066 0 3.527-0.459 4.47-1.402 c0.265-0.264 0.265-0.693 0.002-0.958C18.221 19.5 17.8 19.5 17.5 19.791z"/>
													<path d="M27.707 13.267c0-1.785-1.453-3.237-3.236-3.237c-0.793 0-1.518 0.287-2.082 0.761c-2.039-1.295-4.646-2.069-7.438-2.219 l1.483-4.691l4.062 0.956c0.071 1.4 1.3 2.6 2.7 2.555c1.488 0 2.695-1.208 2.695-2.695C25.881 3.2 24.7 2 23.2 2 c-1.059 0-1.979 0.616-2.42 1.508l-4.633-1.091c-0.344-0.081-0.693 0.118-0.803 0.455l-1.793 5.7 C10.548 8.6 7.7 9.4 5.6 10.75C5.006 10.3 4.3 10 3.5 10.029c-1.785 0-3.237 1.452-3.237 3.2 c0 1.1 0.6 2.1 1.4 2.69c-0.04 0.272-0.061 0.551-0.061 0.831c0 2.3 1.3 4.4 3.7 5.9 c2.299 1.5 5.3 2.3 8.6 2.325c3.228 0 6.271-0.825 8.571-2.325c2.387-1.56 3.7-3.66 3.7-5.917 c0-0.26-0.016-0.514-0.051-0.768C27.088 15.5 27.7 14.4 27.7 13.267z M23.186 3.355c0.74 0 1.3 0.6 1.3 1.3 c0 0.738-0.6 1.34-1.34 1.34s-1.342-0.602-1.342-1.34C21.844 4 22.4 3.4 23.2 3.355z M1.648 13.3 c0-1.038 0.844-1.882 1.882-1.882c0.31 0 0.6 0.1 0.9 0.209c-1.049 0.868-1.813 1.861-2.26 2.9 C1.832 14.2 1.6 13.8 1.6 13.267z M21.773 21.57c-2.082 1.357-4.863 2.105-7.831 2.105c-2.967 0-5.747-0.748-7.828-2.105 c-1.991-1.301-3.088-3-3.088-4.782c0-1.784 1.097-3.484 3.088-4.784c2.081-1.358 4.861-2.106 7.828-2.106 c2.967 0 5.7 0.7 7.8 2.106c1.99 1.3 3.1 3 3.1 4.784C24.859 18.6 23.8 20.3 21.8 21.57z M25.787 14.6 c-0.432-1.084-1.191-2.095-2.244-2.977c0.273-0.156 0.59-0.245 0.928-0.245c1.035 0 1.9 0.8 1.9 1.9 C26.354 13.8 26.1 14.3 25.8 14.605z"/>
											</g>
									</svg>
              </span>
              <span class="text">Reddit</span>
          </a>
      </li>
      <li class="googleplus">
          <a href="https://plus.google.com/share?url=http://chenxiaoyu.org/2010/07/01/pylons-tutorial-database/" class="popup">
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                      <g>
                          <path d="M14.703,15.854l-1.219-0.948c-0.372-0.308-0.88-0.715-0.88-1.459c0-0.748,0.508-1.223,0.95-1.663 c1.42-1.119,2.839-2.309,2.839-4.817c0-2.58-1.621-3.937-2.399-4.581h2.097l2.202-1.383h-6.67c-1.83,0-4.467,0.433-6.398,2.027 C3.768,4.287,3.059,6.018,3.059,7.576c0,2.634,2.022,5.328,5.604,5.328c0.339,0,0.71-0.033,1.083-0.068 c-0.167,0.408-0.336,0.748-0.336,1.324c0,1.04,0.551,1.685,1.011,2.297c-1.524,0.104-4.37,0.273-6.467,1.562 c-1.998,1.188-2.605,2.916-2.605,4.137c0,2.512,2.358,4.84,7.289,4.84c5.822,0,8.904-3.223,8.904-6.41 c0.008-2.327-1.359-3.489-2.829-4.731H14.703z M10.269,11.951c-2.912,0-4.231-3.765-4.231-6.037c0-0.884,0.168-1.797,0.744-2.511 c0.543-0.679,1.489-1.12,2.372-1.12c2.807,0,4.256,3.798,4.256,6.242c0,0.612-0.067,1.694-0.845,2.478 c-0.537,0.55-1.438,0.948-2.295,0.951V11.951z M10.302,25.609c-3.621,0-5.957-1.732-5.957-4.142c0-2.408,2.165-3.223,2.911-3.492 c1.421-0.479,3.25-0.545,3.555-0.545c0.338,0,0.52,0,0.766,0.034c2.574,1.838,3.706,2.757,3.706,4.479 c-0.002,2.073-1.736,3.665-4.982,3.649L10.302,25.609z"/>
                          <polygon points="23.254,11.89 23.254,8.521 21.569,8.521 21.569,11.89 18.202,11.89 18.202,13.604 21.569,13.604 21.569,17.004 23.254,17.004 23.254,13.604 26.653,13.604 26.653,11.89"/>
                      </g>
                  </svg>
              </span>
              <span class="text">Google+</span>
          </a>
      </li>
      <li class="pinterest">
          <script>
						var imgurl = "http:\/\/chenxiaoyu.org\/logo.png";
						var firstimg = document.getElementsByClassName("2010")[0].getElementsByTagName("img")[0];
						if (firstimg !== undefined) {
							imgurl = firstimg.src;
						}
						document.write('<a href="http://pinterest.com/pin/create/button/?url=http:\/\/chenxiaoyu.org\/2010\/07\/01\/pylons-tutorial-database\/&amp;media=' + imgurl + '&amp;description=Pylons 入门实例教程 – 数据库操作" class="popup">');
					</script>
              <span class="icon">
                  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
		                  <path d="M14.021,1.57C6.96,1.57,1.236,7.293,1.236,14.355c0,7.062,5.724,12.785,12.785,12.785c7.061,0,12.785-5.725,12.785-12.785 C26.807,7.294,21.082,1.57,14.021,1.57z M15.261,18.655c-1.161-0.09-1.649-0.666-2.559-1.219c-0.501,2.626-1.113,5.145-2.925,6.458 c-0.559-3.971,0.822-6.951,1.462-10.116c-1.093-1.84,0.132-5.545,2.438-4.632c2.837,1.123-2.458,6.842,1.099,7.557 c3.711,0.744,5.227-6.439,2.925-8.775c-3.325-3.374-9.678-0.077-8.897,4.754c0.19,1.178,1.408,1.538,0.489,3.168 C7.165,15.378,6.53,13.7,6.611,11.462c0.131-3.662,3.291-6.227,6.46-6.582c4.007-0.448,7.771,1.474,8.29,5.239 c0.579,4.255-1.816,8.865-6.102,8.533L15.261,18.655z"/>
                  </svg>
              </span>
              <span class="text">Pinterest</span>
          <script>document.write('</a>');</script>
      </li>
      <li class="pocket">
          <a href="https://getpocket.com/save?url=http://chenxiaoyu.org/2010/07/01/pylons-tutorial-database/"  class="popup">
              <span class="icon">
                  <svg width="32px" height="28px" viewBox="0 0 32 28" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sketch="http://www.bohemiancoding.com/sketch/ns">
                      <path d="M28.7817528,0.00172488695 C30.8117487,0.00431221738 31.9749312,1.12074529 31.9644402,3.10781507 C31.942147,6.67703739 32.1336065,10.2669583 31.8057648,13.8090137 C30.7147076,25.5813672 17.2181194,31.8996281 7.20714461,25.3808491 C2.71833574,22.4571656 0.196577202,18.3122624 0.0549495772,12.9357897 C-0.0342233715,9.5774348 0.00642900214,6.21519891 0.0300336062,2.85555035 C0.0405245414,1.1129833 1.21157517,0.0146615391 3.01995012,0.00819321302 C7.34746087,-0.00603710433 11.6775944,0.00431221738 16.0064164,0.00172488695 C20.2644248,0.00172488695 24.5237444,-0.00215610869 28.7817528,0.00172488695 L28.7817528,0.00172488695 Z M8.64885184,7.85611511 C7.38773662,7.99113854 6.66148108,8.42606978 6.29310958,9.33228474 C5.90114134,10.2969233 6.17774769,11.1421181 6.89875951,11.8276216 C9.35282156,14.161969 11.8108164,16.4924215 14.2976518,18.7943114 C15.3844131,19.7966007 16.5354102,19.7836177 17.6116843,18.7813283 C20.0185529,16.5495467 22.4070683,14.2982907 24.7824746,12.0327533 C25.9845979,10.8850542 26.1012707,9.56468083 25.1469132,8.60653379 C24.1361858,7.59255976 22.8449191,7.6743528 21.5890476,8.85191291 C19.9936451,10.3488554 18.3680912,11.8172352 16.8395462,13.3777945 C16.1342655,14.093159 15.7200114,14.0048744 15.0566806,13.3440386 C13.4599671,11.7484252 11.8081945,10.2060421 10.1262706,8.70001155 C9.65564653,8.27936164 9.00411403,8.05345704 8.64885184,7.85611511 L8.64885184,7.85611511 L8.64885184,7.85611511 Z"></path>
                  </svg>
              </span>
              <span class="text">Pocket</span>
          </a>
      </li>
  </ul>
</div>

    <div itemprop="author" itemscope itemtype="http://schema.org/Person">
  <h5>A propos de l'auteur</h5>
  <section>
    <p><a href="http://profiles.google.com/thibault.normand?rel=author" itemprop="name" rel="author">Thibault Normand</a> est un dévéloppeur et un bloggeur enthousiaste, curieux de toutes nouvelles technologies liées à la sécurité, l'architecture, et le
      web. <a href="http://zenithar.org/" rel="me">Plus d'infos...</a>
    </p>
  </section>
</div>
    <div id="comments">
    
    
    
    
</div>

</article>

</main>
		<footer id="footer">
			<section id="footer-message">&copy; smallfish&#39;s blog. All rights reserved. Powered by <a href="http://gohugo.io" target="_blank">Hugo</a>. <a href="https://github.com/kathyqian/crisp-ghost-theme" target="_blank">Crisp</a> theme by <a href="http://kathyqian.com" target="_blank">Kathy Qian</a>.</section>
		</footer>

    <script>
      (function(c,f){asyncLoader=function(i,h){i.foreach(function(k,j){e(j,d(j),h)});if(typeof h.callback=="function"){var g=setInterval(function(){if(f.readyState==="complete"){clearInterval(g);h.callback()}},10)}};var d=function(g){var h=g.split(".");return h[h.length-1]},e=function(h,i,g){switch(i){case"js":a(h,g);break;case"css":b(h);break;default:break}},a=function(i,h){var g=document.createElement("script");g.type="text/javascript";g.async=true;g.src=i;document.getElementsByTagName("head")[0].appendChild(g)},b=function(g){var h=document.createElement("link");h.type="text/css";h.rel="stylesheet";h.href=g;document.getElementsByTagName("head")[0].appendChild(h)};Array.prototype.foreach=function(h){for(var g=0;g<this.length;g++){h(g,this[g])}}})(this,document);

      var WebFontConfig={google:{families:["Open Sans:300italic,700italic,300,700","Bree+Serif"]}};
      asyncLoader([
        "//netdna.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.css",
        "//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js",
        "//cdnjs.cloudflare.com/ajax/libs/webfont/1.5.16/webfontloader.js",
        "//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"
      ],{
        callback:function(){
          asyncLoader([
            "http:\/\/chenxiaoyu.org\/css/rrssb.css",
            "http:\/\/chenxiaoyu.org\/js/gist.min.js", 
            "http:\/\/chenxiaoyu.org\/js/rrssb.min.js",
            "//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/default.min.css"
          ], { callback:function() {
              hljs.initHighlighting();
          }});
        }
      });
    </script>
	
	</body>
</html>
